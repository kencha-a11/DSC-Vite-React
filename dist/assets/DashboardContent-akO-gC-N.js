import{j as e,r as a,A as T,u as ie}from"./index-DAizD6vu.js";import{u as P}from"./useInfiniteScroll-p2SrH_vJ.js";const de=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",className:"w-5 h-5 text-gray-500",children:[e.jsx("path",{d:"M12 2L12 22",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",strokeLinecap:"round",strokeLinejoin:"round"})]}),ge=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5 text-gray-500",children:[e.jsx("path",{d:"M6 10l-2 10h16l-2-10H6z"}),e.jsx("circle",{cx:"12",cy:"15",r:"1",fill:"currentColor",stroke:"none"}),e.jsx("path",{d:"M10 5l4 0"}),e.jsx("path",{d:"M12 2l0 3"})]}),xe=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5 text-gray-500",children:[e.jsx("path",{d:"M12.89 1.15l8 4a1 1 0 0 1 0 1.7l-8 4a1 1 0 0 1-1.78 0l-8-4a1 1 0 0 1 0-1.7l8-4a1 1 0 0 1 1.78 0z"}),e.jsx("path",{d:"M2.33 13.92a1 1 0 0 0 .52 1.25l8 4a1 1 0 0 0 1 0l8-4a1 1 0 0 0 .52-1.25M6 13l0 6"}),e.jsx("path",{d:"M18 13l0 6"}),e.jsx("path",{d:"M12 11l0 8"})]}),me=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",className:"w-5 h-5 text-gray-500",children:[e.jsx("path",{d:"M4 3h16v18l-3-2-3 2-3-2-3 2-3-2V3z"}),e.jsx("line",{x1:"8",y1:"7",x2:"16",y2:"7"}),e.jsx("line",{x1:"8",y1:"11",x2:"16",y2:"11"}),e.jsx("line",{x1:"8",y1:"15",x2:"13",y2:"15"})]}),ue=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",className:"w-5 h-5 text-gray-500",children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"8.5",cy:"7",r:"4"}),e.jsx("path",{d:"M20 8v6M23 11H17"})]}),he=({className:s="w-5 h-5"})=>e.jsxs("svg",{className:s,viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:[e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 7V12L15 14",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M4 4L6 6",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M20 4L18 6",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),se=({type:s,value:t,percentageChange:r,isIncrease:d})=>{const m=d?"text-green-600":"text-red-600",o=d?"bg-green-100":"bg-red-100",l=d?"â†‘":"â†“",g={totalSales:{label:"Total Sales",icon:e.jsx(de,{})},totalItems:{label:"Total Items Sold",icon:e.jsx(ge,{})},totalTransactions:{label:"Total Transactions",icon:e.jsx(me,{})},inventoryCount:{label:"Inventory Count",icon:e.jsx(xe,{})},activeUsers:{label:"Active Users",icon:e.jsx(ue,{})},totalLogs:{label:"User Log",icon:e.jsx(he,{})}}[s]||{label:s,icon:e.jsx("div",{className:"w-5 h-5 bg-gray-300"})};let n;return s==="activeUsers"?n=e.jsx("div",{className:"flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-green-100 text-green-700",children:"Active"}):s!=="totalLogs"?n=e.jsxs("div",{className:`flex items-center px-3 py-1 rounded-full text-sm font-semibold ${o} ${m}`,children:[e.jsx("span",{className:"mr-1",children:l}),e.jsxs("span",{children:[r,"%"]})]}):n=null,e.jsxs("div",{className:"p-4 border border-gray-200 rounded-xl bg-white shadow-sm w-full",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center mb-4 border border-gray-300 rounded-lg",children:g.icon}),e.jsx("p",{className:"mb-2 text-lg text-gray-600",children:g.label}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:t}),n]})]})},fe=({title:s,data:t,selectedYear:r,onYearChange:d,className:m=""})=>{const o=t.map(n=>n.month.substring(0,3)),l=t.map(n=>n.total_sales),c=Math.max(...l),g=Array.from({length:6},(n,u)=>`â‚±${(c/5*u).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`);return e.jsxs("div",{className:`bg-white border border-gray-200 rounded-xl shadow-sm ${m}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:s}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:"block appearance-none w-full bg-white border border-gray-300 text-gray-700 py-2 px-4 pr-8 rounded-md leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm","aria-label":"Select year",value:r,onChange:n=>d(Number(n.target.value)),children:e.jsx("option",{value:"2025",children:"2025"})}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:e.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]})]}),e.jsxs("div",{className:"flex p-4",children:[e.jsx("div",{className:"flex flex-col justify-between pr-4 text-sm text-gray-600 font-medium whitespace-nowrap",children:g.slice().reverse().map((n,u)=>e.jsx("span",{children:n},u))}),e.jsxs("div",{className:"grow",children:[e.jsxs("svg",{className:"w-full",viewBox:"0 0 600 200",preserveAspectRatio:"none",children:[g.map((n,u)=>e.jsx("line",{x1:"0",y1:200-u*(200/(g.length-1)),x2:"600",y2:200-u*(200/(g.length-1)),stroke:"#e5e7eb",strokeWidth:"1",strokeDasharray:"2 2"},`grid-${u}`)),e.jsx("polyline",{fill:"none",stroke:"#8b5cf6",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",points:l.map((n,u)=>{const i=u/(l.length-1)*600,x=200-n/c*180;return`${i},${x}`}).join(" ")}),e.jsx("polygon",{fill:"#ede9fe",points:`0,200 ${l.map((n,u)=>{const i=u/(l.length-1)*600,x=200-n/c*180;return`${i},${x}`}).join(" ")} 600,200`})]}),e.jsx("div",{className:"flex justify-between mt-2 text-sm text-gray-600 font-medium",children:o.map((n,u)=>e.jsx("span",{children:n},u))})]})]})]})},pe=({title:s="Top-selling items",items:t=[],className:r=""})=>{if(!t||t.length===0)return e.jsxs("div",{className:`bg-white border border-gray-200 rounded-xl  ${r}`,children:[e.jsx("h3",{className:"p-4 text-lg font-medium text-gray-900 border-b border-gray-200",children:s}),e.jsx("div",{className:"p-4 text-gray-500 text-sm text-center",children:"No data available"})]});const d=Math.max(...t.map(m=>m.total_sold));return e.jsxs("div",{className:`bg-white border border-gray-200 rounded-xl ${r}`,children:[e.jsx("h3",{className:"p-4 text-lg font-medium text-gray-900 border-b border-gray-200",children:s}),e.jsx("div",{className:"p-4 space-y-3",children:t.map((m,o)=>{const l=m.total_sold/d*100,c=o%2===0?"bg-blue-600":"bg-blue-300";return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm text-gray-800 mb-1",children:m.product_name}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"grow h-6 relative bg-gray-100 rounded-sm overflow-hidden",children:e.jsx("div",{className:`h-full absolute left-0 top-0 ${c}`,style:{width:`${l}%`,transition:"width 0.3s ease"}})}),e.jsxs("span",{className:"ml-3 text-sm font-semibold text-blue-600 whitespace-nowrap",children:[m.total_sold," pcs"]})]})]},o)})})]})},te=a.forwardRef(({items:s,selectedDays:t,onDaysChange:r,loading:d,sentinelRef:m,containerRef:o},l)=>{const c=[7,14,30,60,90],g=n=>{if(!n||n==="Never")return null;const u=Math.abs(new Date-new Date(n));return Math.ceil(u/(1e3*60*60*24))};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-gray-200 border-b",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Not-selling items"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("select",{value:t,onChange:n=>r(Number(n.target.value)),className:"px-3 py-1 text-sm font-semibold text-gray-700 bg-gray-100 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:c.map(n=>e.jsxs("option",{value:n,children:[n,"+"]},n))}),e.jsx("span",{className:"text-sm text-gray-700",children:"days unsold"})]})]}),e.jsxs("div",{className:"max-h-96 overflow-y-auto divide-y",ref:o,children:[s.length===0&&!d?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No items found"}):s.map((n,u)=>{const i=g(n.last_sold_date);return e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between border-gray-200",children:[e.jsx("p",{className:"text-base font-medium text-gray-800",children:n.product_name||n.name}),i!==null&&e.jsxs("span",{className:"text-gray-500",children:[i," days ago"]})]},n.id||u)}),e.jsx("div",{ref:m,className:"p-4 text-center",children:d&&e.jsx("span",{className:"text-sm text-gray-500",children:"Loading more..."})})]})]})});te.displayName="NonSellingProductList";const ye=({data:s,loading:t,sentinelRef:r,containerRef:d,loadMore:m})=>{const o=(l,c)=>l==="Out of Stock"||c===0?e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-red-100 text-red-700 rounded",children:"Out of Stock"}):e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-orange-100 text-orange-700 rounded",children:"Low Stock"});return a.useEffect(()=>{if(!r?.current||!d?.current)return;const l=new IntersectionObserver(([c])=>{c.isIntersecting&&!t&&m()},{root:d.current,rootMargin:"0px",threshold:1});return l.observe(r.current),()=>{r.current&&l.unobserve(r.current)}},[r,d,m,t]),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between p-4 border-gray-200 border-b",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Stock Alert"})}),e.jsxs("div",{className:"max-h-96 overflow-y-auto divide-y",ref:d,children:[s.length===0&&!t?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No low stock items"}):s.map((l,c)=>e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between border-gray-200",children:[e.jsx("p",{className:"text-base font-medium text-gray-800",children:l.product_name}),e.jsxs("div",{className:"flex items-center space-x-3 text-sm mt-2 sm:mt-0",children:[e.jsxs("div",{children:[e.jsx("span",{className:`font-medium ${l.stock===0?"text-red-600":l.stock<=5?"text-orange-600":"text-gray-800"}`,children:l.stock??0}),e.jsx("span",{className:"text-gray-600",children:" remaining "})]}),o(l.status,l.stock)]})]},l.id||c)),e.jsx("div",{ref:r,className:"p-4 text-center",children:t&&e.jsx("span",{className:"text-sm text-gray-500",children:"Loading more..."})})]})]})},be=async(s,t)=>(await T.get("/dashboard/manager",{params:{year:s,days:t}})).data,ve=async(s=1,t=30)=>(await T.get("/dashboard/manager/non-selling",{params:{page:s,days:t}})).data,je=async(s=1)=>(await T.get("/dashboard/manager/low-stock",{params:{page:s}})).data,Ne=async()=>(await T.get("/dashboard/cashier")).data,we=async(s=1,t="")=>(await T.get("/dashboard/cashier/inventory",{params:{page:s,search:t||void 0}})).data,Se=async(s=1,t="")=>(await T.get("/dashboard/cashier/time-logs",{params:{page:s,date:t||void 0}})).data,_e=async(s=1,t="")=>(await T.get("/dashboard/cashier/sales-logs",{params:{page:s,date:t||void 0}})).data,Le=()=>{const[s,t]=a.useState(!0),[r,d]=a.useState(null),[m,o]=a.useState(30),[l,c]=a.useState(1),[g,n]=a.useState([]),[u,i]=a.useState(!0),[x,h]=a.useState(!1),[p,w]=a.useState(1),[j,S]=a.useState([]),[_,N]=a.useState(!0),[y,L]=a.useState(!1),C=a.useRef(null),D=a.useRef(null),M=a.useRef(null),I=a.useRef(null);a.useEffect(()=>{(async()=>{t(!0);try{const f=await be();d(f)}catch(f){console.error("Error fetching dashboard:",f)}finally{t(!1)}})()},[]),a.useEffect(()=>{(async()=>{if(!(x||!u&&l>1)){h(!0);try{const f=await ve(l,m);n(R=>l===1?f.data:[...R,...f.data]),i(f.meta.current_page<f.meta.last_page)}catch(f){console.error("Error fetching non-selling products:",f),i(!1)}finally{h(!1)}}})()},[l,m]),a.useEffect(()=>{(async()=>{if(!(y||!_&&p>1)){L(!0);try{const f=await je(p);S(R=>p===1?f.data:[...R,...f.data]),N(f.meta.current_page<f.meta.last_page)}catch(f){console.error("Error fetching stock alerts:",f),N(!1)}finally{L(!1)}}})()},[p]);const k=a.useCallback(()=>{!x&&u&&c(f=>f+1)},[x,u]),B=a.useCallback(()=>{!y&&_&&w(f=>f+1)},[y,_]);return P(C,k,u,x,M.current),P(D,B,_,y,I.current),{loading:s,dashboard:r,nonSelling:g,stockAlerts:j,selectedDays:m,nonSellingRef:C,stockRef:D,nonSellingContainerRef:M,stockContainerRef:I,loadingNonSelling:x,loadingStock:y,handleDaysChange:f=>{o(f),c(1),n([]),i(!0)}}};function ke(){const{loading:s,dashboard:t,nonSelling:r,stockAlerts:d,selectedDays:m,nonSellingRef:o,stockRef:l,nonSellingContainerRef:c,stockContainerRef:g,loadingNonSelling:n,loadingStock:u,handleDaysChange:i}=Le();if(s)return e.jsx("div",{className:"p-6 text-gray-500",children:"Loading dashboard..."});if(!t)return e.jsx("div",{className:"p-6 text-red-500",children:"No dashboard data available."});const x=[{key:"totalSales",value:`â‚±${t.total_sales?.current?.toLocaleString()??0}`,percentageChange:t.total_sales?.change_percentage??"0",isIncrease:parseFloat(t.total_sales?.change_percentage||"0")>=0},{key:"totalItems",value:t.total_items_sold?.current??0,percentageChange:t.total_items_sold?.change_percentage??"0",isIncrease:parseFloat(t.total_items_sold?.change_percentage||"0")>=0},{key:"totalTransactions",value:t.total_transactions?.current??0,percentageChange:t.total_transactions?.change_percentage??"0",isIncrease:parseFloat(t.total_transactions?.change_percentage||"0")>=0},{key:"inventoryCount",value:t.inventory_count?.current??0,percentageChange:t.inventory_count?.change_percentage??"0",isIncrease:parseFloat(t.inventory_count?.change_percentage||"0")>=0},{key:"activeUsers",value:`${t.active_users?.active_users??0} / ${t.active_users?.total_users??0}`,percentageChange:"0",isIncrease:!0}];return e.jsxs("main",{className:"flex flex-col",children:[e.jsx("div",{className:"flex space-x-4",children:x.map(h=>e.jsx(se,{type:h.key,value:h.value,percentageChange:h.percentageChange,isIncrease:h.isIncrease},h.key))}),e.jsxs("section",{className:"flex flex-wrap lg:flex-nowrap gap-4 mt-6",children:[e.jsxs("div",{className:"lg:w-3/5 w-full space-y-6",children:[e.jsx(fe,{title:"Yearly Sales Trend",data:t.sales_trend||[]}),e.jsx(pe,{title:"Top-Selling Products",items:t.top_products||[]})]}),e.jsxs("div",{className:"lg:w-2/5 w-full flex flex-col space-y-4 h-[calc(100vh-200px)]",children:[e.jsx(te,{items:r,selectedDays:m,onDaysChange:i,loading:n,sentinelRef:o,containerRef:c}),e.jsx(ye,{data:Array.isArray(d)?d:[],loading:u,sentinelRef:l,containerRef:g})]})]})]})}const ae=a.memo(({item:s})=>{const t=r=>{r.target.style.display="none",r.target.nextSibling&&(r.target.nextSibling.style.display="flex")};return e.jsxs("div",{className:"grid grid-cols-[80px_2fr_1fr_1.2fr_1.5fr_1fr] items-center py-3 px-4 border-b border-gray-200 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex justify-center",children:[s.image?e.jsx("img",{src:s.image,alt:s.product_name,loading:"lazy",className:"w-12 h-12 object-cover rounded-md",onError:t}):null,e.jsx("div",{className:"w-12 h-12 border border-gray-300 rounded-md flex items-center justify-center text-gray-400 text-sm font-semibold bg-gray-50",style:{display:s.image?"none":"flex"},children:s.product_name?.charAt(0).toUpperCase()||"?"})]}),e.jsx("div",{className:"text-gray-800 font-medium truncate pr-2",title:s.product_name,children:s.product_name}),e.jsx("div",{className:"text-gray-700",children:s.stock??0}),e.jsxs("div",{className:"text-gray-700",children:["â‚± ",parseFloat(s.price??0).toFixed(2)]}),e.jsx("div",{className:"text-gray-700 truncate",title:s.categories?.map(r=>r.name).join(", "),children:s.categories?.length>0?s.categories.map(r=>r.name).join(", "):"-"}),e.jsx("div",{className:`font-semibold capitalize ${s.statusColor??"text-green-600"}`,children:s.status??"In stock"})]})});ae.displayName="InventoryRow";const Ce=()=>e.jsx("div",{className:"animate-pulse space-y-3 p-4",children:[...Array(5)].map((s,t)=>e.jsxs("div",{className:"grid grid-cols-[80px_2fr_1fr_1.2fr_1.5fr_1fr] gap-4 items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-md"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-12"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})]},t))}),re=a.memo(({data:s,loading:t,meta:r,loadMore:d,scrollRef:m,searchTerm:o,setSearchTerm:l})=>{const c=m||a.useRef(null),g=a.useRef(null);a.useEffect(()=>{const i=g.current,x=c.current;if(!i||!x||!d)return;const h=new IntersectionObserver(([p])=>{p.isIntersecting&&!t&&r?.current_page<r?.last_page&&(console.log("[InventoryTable] Sentinel visible, loading page",r.current_page+1),d())},{root:x,rootMargin:"300px",threshold:0});return h.observe(i),()=>h.disconnect()},[t,r?.current_page,r?.last_page,d,c]);const n=!t&&s.length===0,u=t&&s.length===0;return e.jsxs("div",{className:"flex flex-col bg-white shadow-md rounded-lg overflow-hidden h-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 p-4 border-b border-gray-200 flex-none bg-white",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Inventory"}),e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx("input",{type:"text",placeholder:"Search items...",value:o,onChange:i=>l(i.target.value),className:"w-full border border-gray-300 rounded-lg py-2 px-4 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-shadow"}),o&&e.jsx("button",{onClick:()=>l(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:"âœ•"})]})]}),e.jsxs("div",{ref:c,className:"flex-1 min-h-0 overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 z-10 grid grid-cols-[80px_2fr_1fr_1.2fr_1.5fr_1fr] text-xs sm:text-sm font-semibold text-gray-600 bg-gray-100 border-b border-gray-300 shadow-sm",children:["Image","Item name","Stock","Unit price","Category","Status"].map((i,x)=>e.jsx("div",{className:`py-3 px-2 ${x===0?"justify-center flex":""}`,children:i},x))}),u&&e.jsx(Ce,{}),n&&e.jsx("div",{className:"p-4 text-gray-500",children:"No inventory items found"}),s.length>0&&e.jsxs(e.Fragment,{children:[s.map(i=>e.jsx(ae,{item:i},i.id)),e.jsx("div",{ref:g,className:"h-20"}),t&&s.length>0&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"}),e.jsx("p",{className:"mt-2 text-sm",children:"Loading more items..."})]}),!t&&r?.current_page>=r?.last_page&&s.length>0&&e.jsx("div",{className:"text-center py-4 text-gray-400 text-sm",children:"End"})]})]})]})});re.displayName="InventoryTable";const ne=a.memo(({log:s})=>{const[t,r]=a.useState(s?.duration??"0m");return a.useEffect(()=>{let d=!0,m=null;const o=(...i)=>{console.debug("[TimeLogEntry]",...i)};if(o("ðŸŸ¢ effect start",{log:s}),!s)return o("âš ï¸ no log provided"),()=>{d=!1};if(s.end!=="Ongoing")return o("â„¹ï¸ log is not ongoing, static duration:",s.duration),r(s.duration??"0m"),()=>{d=!1};const c=(()=>{if(o("ðŸ” Parsing start_time:",s.start_time),s.start_time){const i=s.start_time.replace(/\.\d+Z$/,"Z"),x=Date.parse(i);if(o("ðŸ“… Date.parse(safeStart):",{safeStart:i,parsed:x}),!Number.isNaN(x))return x;const h=new Date(i).getTime();if(o("ðŸ“… new Date().getTime():",{safeStart:i,alt:h}),!Number.isNaN(h))return h}if(s.date&&s.start){const i=`${s.date} ${s.start}`,x=Date.parse(i);if(o("ðŸ“… Date.parse(date + start):",{combined:i,parsed2:x}),!Number.isNaN(x))return x;try{o("âš™ï¸ Manual parse fallback:",{date:s.date,start:s.start});const[h,p,w]=s.date.split(" "),j=parseInt(p.replace(",",""),10),[S,_]=s.start.split(" ");let[N,y]=S.split(":").map(Number);_==="PM"&&N!==12&&(N+=12),_==="AM"&&N===12&&(N=0);const L=new Date(`${h} 1, 2000`).getMonth(),C=new Date(Number(w),L,j,N,y,0);return o("ðŸ§­ Manual Date constructed:",C.toISOString()),C.getTime()}catch(h){console.error("âŒ Manual parse error:",h)}}if(s.start_time&&typeof s.start_time=="string"){const i=s.start_time.endsWith("Z")?s.start_time:`${s.start_time}Z`,x=Date.parse(i);if(o("ðŸ“… Try append Z:",{maybeIso:i,parsed3:x}),!Number.isNaN(x))return x}return o("ðŸš« All parsing attempts failed"),NaN})();if(o("âœ… final startMs:",c),Number.isNaN(c))return console.error("[TimeLogEntry] âŒ Could not parse start timestamp:",s),()=>{d=!1};const g=Date.now();c-g>5e3&&console.warn("[TimeLogEntry] âš ï¸ start is in the future",{startMs:c,startIso:new Date(c).toISOString(),now:g,nowIso:new Date(g).toISOString(),diffMs:c-g});const u=()=>{if(!d)return;const i=Date.now(),x=Math.max(0,i-c),h=Math.floor(x/(1e3*60)),p=Math.floor(h/60),w=h%60,j=h<1?"0m":p===0?`${w}m`:w===0?`${p}h`:`${p}h ${w}m`;o("ðŸ•’ updateDuration",{nowInner:i,startMs:c,diffMs:x,totalMinutes:h,hours:p,minutes:w,formatted:j}),r(S=>S===j?S:j)};return u(),m=setInterval(u,1e3),()=>{o("ðŸ”´ cleanup"),d=!1,m&&clearInterval(m)}},[s]),e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-200 last:border-b-0 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex flex-col min-w-[50%] pr-4",children:[e.jsx("span",{className:"text-gray-800 font-medium text-base",children:s?.date}),e.jsx("span",{className:"text-gray-500 text-sm",children:s?.day})]}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsxs("span",{className:"text-gray-800 font-medium",children:["Start: ",s?.start]}),e.jsxs("span",{className:"text-gray-800 font-medium mb-1",children:["End: ",s?.end]}),e.jsxs("span",{className:"text-gray-800 font-medium",children:["Duration: ",e.jsx("span",{className:"font-bold",children:t})]})]})]})});ne.displayName="TimeLogEntry";const Me=({data:s=[],meta:t={},loading:r=!1,loadMoreTimeLogs:d,scrollRef:m,sentinelRef:o})=>s.length===0&&!r?e.jsx("div",{ref:m,className:"flex-1 overflow-y-auto min-h-0 h-[53vh] flex items-center justify-center",children:e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-400 text-lg",children:"No time logs found"})})}):e.jsxs("div",{ref:m,className:"flex-1 overflow-y-auto min-h-0 h-[53vh]",children:[s.map((l,c)=>e.jsx(ne,{log:l},l.id??`time-${c}`)),e.jsx("div",{ref:o,className:"h-10"}),r&&s.length>0&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2"}),e.jsx("p",{className:"mt-2 text-sm",children:"Loading more logs..."})]}),!r&&t?.current_page>=t?.last_page&&s.length>0&&e.jsx("div",{className:"text-center py-4 text-gray-400 text-sm",children:"End"})]}),oe=a.memo(({log:s})=>{const t=s.time??"N/A";return e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-200 last:border-b-0 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex flex-col min-w-[50%] pr-4",children:[e.jsx("span",{className:"text-gray-800 font-medium text-base",children:s.date}),e.jsx("span",{className:"text-gray-500 text-sm",children:s.day}),e.jsx("span",{className:"text-gray-500 text-sm",children:t})]}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsxs("span",{className:"text-gray-800 font-medium mb-1",children:[e.jsx("span",{className:"font-bold text-fuchsia-600",children:s.items})," items"]}),e.jsxs("span",{className:"text-gray-500 text-sm",children:["Total: ",e.jsx("span",{className:"text-green-600 font-bold text-lg",children:s.total})]})]})]})});oe.displayName="SalesLogEntry";const De=({data:s=[],meta:t={},loading:r=!1,loadMoreSalesLogs:d,scrollRef:m,sentinelRef:o,dateFilter:l=""})=>{const c=a.useMemo(()=>{let g=s;return l&&(g=g.filter(n=>n.start_time.startsWith(l))),g.sort((n,u)=>new Date(u.start_time).getTime()-new Date(n.start_time).getTime()),g},[s,l]);return a.useEffect(()=>{if(!o?.current||!d)return;const g=new IntersectionObserver(n=>{n[0].isIntersecting&&!r&&t.current_page<t.last_page&&d()},{root:null,threshold:.1});return g.observe(o.current),()=>g.disconnect()},[o,d,r,t]),c.length===0&&!r?e.jsx("div",{ref:m,className:"flex-1 overflow-y-auto min-h-0 h-[53vh] flex items-center justify-center",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-400 text-lg",children:"No sales logs found"}),l&&e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Try selecting a different date"})]})}):e.jsxs("div",{ref:m,className:"flex-1 overflow-y-auto min-h-0 h-[53vh]",children:[c.map((g,n)=>e.jsx(oe,{log:g},g.id??`sales-${n}`)),e.jsx("div",{ref:o,className:"h-10"}),r&&c.length>0&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-fuchsia-600"}),e.jsx("p",{className:"mt-2 text-sm",children:"Loading more sales..."})]}),!r&&t?.current_page>=t?.last_page&&c.length>0&&e.jsx("div",{className:"text-center py-4 text-gray-400 text-sm",children:"End"})]})},Ie=({timeLogs:s=[],timeLogsMeta:t={},loadingTimeLogs:r=!1,loadMoreTimeLogs:d,timeLogsRef:m,sentinelRef:o,setTimeLogsDateFilter:l,salesLogs:c=[],salesLogsMeta:g={},loadingSalesLogs:n=!1,loadMoreSalesLogs:u,salesLogsRef:i,sentinelRefSales:x,setSalesLogsDateFilter:h})=>{const[p,w]=a.useState("timeLogs"),[j,S]=a.useState(""),_=y=>{const L=y.target.value;S(L),l(L),h(L)},N=[{id:"timeLogs",label:"Time logs"},{id:"salesLog",label:"Sales log"}];return e.jsxs("div",{className:"w-full flex flex-col bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden h-[68vh]",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-200 flex-none gap-2",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Records"}),e.jsx("input",{type:"date",value:j,onChange:_,className:"border border-gray-300 rounded-lg p-2 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-fuchsia-500"})]}),e.jsx("div",{className:"flex justify-between border-b border-gray-200 flex-none",children:N.map(y=>e.jsxs("button",{className:`w-1/2 relative p-4 text-center text-base font-semibold transition-colors ${p===y.id?"text-fuchsia-700 bg-fuchsia-50":"text-gray-500 bg-white hover:bg-gray-50"} focus:outline-none`,onClick:()=>w(y.id),children:[y.label,p===y.id&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-fuchsia-700 rounded-t-sm"})]},y.id))}),e.jsxs("div",{className:"flex-1 min-h-0 overflow-hidden",children:[p==="timeLogs"&&e.jsx(Me,{data:s,loading:r,loadMoreTimeLogs:d,meta:t,scrollRef:m,sentinelRef:o,dateFilter:j}),p==="salesLog"&&e.jsx(De,{data:c,loading:n,loadMoreSalesLogs:u,meta:g,scrollRef:i,sentinelRef:x,dateFilter:j})]})]})},Te=()=>{const[s,t]=a.useState(null),[r,d]=a.useState(!0),[m,o]=a.useState(null),[l,c]=a.useState([]),[g,n]=a.useState({}),[u,i]=a.useState(!1),[x,h]=a.useState(1),[p,w]=a.useState(""),j=a.useRef(null),S=a.useRef(null),[_,N]=a.useState([]),[y,L]=a.useState({}),[C,D]=a.useState(!1),[M,I]=a.useState(1),[k,B]=a.useState(""),O=a.useRef(null),f=a.useRef(null),[R,Z]=a.useState([]),[E,le]=a.useState({}),[V,Q]=a.useState(!1),[F,Y]=a.useState(1),[W,ce]=a.useState(""),q=a.useRef(null),G=a.useRef(null),J=a.useCallback(async()=>{try{d(!0);const b=await Ne();t(b)}catch(b){o(b)}finally{d(!1)}},[]),H=a.useCallback(async(b,$="")=>{i(!0);try{const v=await we(b,$);c(A=>b===1?v.data:[...A,...v.data]),n(v.meta)}catch(v){o(v)}finally{i(!1)}},[]),U=a.useCallback(async(b,$="")=>{D(!0);try{const v=await Se(b,$);N(A=>b===1?v.data:[...A,...v.data]),L(v.meta)}catch(v){o(v)}finally{D(!1)}},[]),z=a.useCallback(async(b,$="")=>{Q(!0);try{const v=await _e(b,$);Z(A=>b===1?v.data:[...A,...v.data]),le(v.meta)}catch(v){o(v)}finally{Q(!1)}},[]),K=a.useCallback(()=>{g?.current_page<g?.last_page&&h(b=>b+1)},[g]),X=a.useCallback(()=>{y?.current_page<y?.last_page&&I(b=>b+1)},[y]),ee=a.useCallback(()=>{E?.current_page<E?.last_page&&Y(b=>b+1)},[E]);return P(S,K,x<(g?.last_page||0),u,j),P(f,X,M<(y?.last_page||0),C,O),P(G,ee,F<(E?.last_page||0),V,q),a.useEffect(()=>{J()},[J]),a.useEffect(()=>{h(1),c([]),H(1,p)},[p,H]),a.useEffect(()=>{x>1&&H(x,p)},[x]),a.useEffect(()=>{I(1),N([]),U(1,k)},[k,U]),a.useEffect(()=>{M>1&&U(M,k)},[M]),a.useEffect(()=>{Y(1),Z([]),z(1,W)},[W,z]),a.useEffect(()=>{F>1&&z(F,W)},[F]),{dashboardData:s,loadingDashboard:r,error:m,inventory:l,inventoryMeta:g,loadingInventory:u,inventoryRef:j,inventorySentinelRef:S,loadMoreInventory:K,inventorySearch:p,setInventorySearch:w,timeLogs:_,timeLogsMeta:y,loadingTimeLogs:C,timeLogsRef:O,timeLogsSentinelRef:f,loadMoreTimeLogs:X,timeLogsDateFilter:k,setTimeLogsDateFilter:B,salesLogs:R,salesLogsMeta:E,loadingSalesLogs:V,salesLogsRef:q,salesLogsSentinelRef:G,loadMoreSalesLogs:ee,salesLogsDateFilter:W,setSalesLogsDateFilter:ce}},Re=s=>{if(s==null)return"0h";const t=Math.round(Math.abs(s)*60),r=Math.floor(t/60),d=t%60;return d>0?`${r}h ${d}m`:`${r}h`};function Ee(){const{dashboardData:s,loadingDashboard:t,error:r,inventory:d,inventoryMeta:m,loadingInventory:o,loadMoreInventory:l,inventoryRef:c,inventorySentinelRef:g,inventorySearch:n,setInventorySearch:u,timeLogs:i,timeLogsMeta:x,loadingTimeLogs:h,loadMoreTimeLogs:p,timeLogsRef:w,timeLogsSentinelRef:j,setTimeLogsDateFilter:S,salesLogs:_,salesLogsMeta:N,loadingSalesLogs:y,loadMoreSalesLogs:L,salesLogsRef:C,salesLogsSentinelRef:D,setSalesLogsDateFilter:M}=Te();if(console.log(s),t)return e.jsx("div",{children:"Loading dashboard..."});if(r)return e.jsxs("div",{children:["Error: ",r?.message]});if(!s||!s.data)return e.jsx("div",{children:"No dashboard data"});const I=[{key:"totalSales",value:`â‚± ${s.data.total_sales?.current?.toLocaleString()||0}`,percentageChange:Math.abs(parseFloat(s.data.total_sales?.change_percentage)||0),isIncrease:!s.data.total_sales?.change_percentage?.includes("-")},{key:"totalItems",value:s.data.total_items_sold?.current||0,percentageChange:Math.abs(parseFloat(s.data.total_items_sold?.change_percentage)||0),isIncrease:!s.data.total_items_sold?.change_percentage?.includes("-")},{key:"totalTransactions",value:s.data.total_transactions?.current||0,percentageChange:Math.abs(parseFloat(s.data.total_transactions?.change_percentage)||0),isIncrease:!s.data.total_transactions?.change_percentage?.includes("-")},{key:"totalLogs",value:Re(s.data.total_logged_hours),percentageChange:0,isIncrease:!0}];return e.jsxs("main",{className:"flex flex-col space-y-4 h-full overflow-hidden",children:[e.jsx("section",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 flex-none",children:I.map(k=>e.jsx(se,{type:k.key,value:k.value,percentageChange:k.percentageChange,isIncrease:k.isIncrease},k.key))}),e.jsxs("section",{className:"w-full flex flex-col lg:flex-row gap-4 flex-1 min-h-0",children:[e.jsx("div",{className:"w-full lg:w-3/5 flex flex-col min-h-0",children:e.jsx(re,{data:d,loading:o,meta:m,loadMore:l,scrollRef:c,sentinelRef:g,searchTerm:n,setSearchTerm:u})}),e.jsx("div",{className:"w-full lg:w-2/5 flex flex-col min-h-0",children:e.jsx(Ie,{timeLogs:i,timeLogsMeta:x,loadingTimeLogs:h,loadMoreTimeLogs:p,scrollRef:w,sentinelRef:j,setTimeLogsDateFilter:S,salesLogs:_,salesLogsMeta:N,loadingSalesLogs:y,loadMoreSalesLogs:L,salesLogsRef:C,sentinelRefSales:D,setSalesLogsDateFilter:M})})]})]})}const $e=a.memo(Ee);function Fe(){const{user:s}=ie();return s?e.jsx("div",{className:"p-4 h-[91.3vh] overflow-auto",children:s.role==="admin"?e.jsx(ke,{}):e.jsx($e,{})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-lg text-gray-600",children:"Please log in to view dashboard"})})}export{Fe as default};
