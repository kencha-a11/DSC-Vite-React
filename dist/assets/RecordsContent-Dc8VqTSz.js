import{A as k,r as s,j as e}from"./index-D0jo8c7A.js";import{u as U}from"./useDebounce-DO-xG3z_.js";import{u as M}from"./useInfiniteScroll-D9_7PBoy.js";async function E(n={}){return(await k.get("/logs/time",{params:n}))?.data?.data??[]}async function I(n={}){try{const l=await k.get("/logs/sales",{params:n});return Array.isArray(l?.data?.data)?l.data.data:[]}catch(l){return console.error("Failed to fetch sales logs:",l),[]}}async function T(n={}){return(await k.get("/logs/inventory",{params:n}))?.data?.data??[]}function q(){const[n,l]=s.useState([]),[i,v]=s.useState(!1),[y,L]=s.useState(""),[u,D]=s.useState(""),[x,C]=s.useState(""),[m,w]=s.useState(""),[j,h]=s.useState(1),[b,p]=s.useState(!0),N=s.useRef(),S=U(y,400),_=s.useCallback(async(t=1)=>{v(!0);try{const g=await E({user_id:u||void 0,date:x||void 0,status:m||void 0,page:t,limit:20});l(c=>t===1?g:[...c,...g]),p(g.length>0)}catch(d){console.error("❌ Failed to fetch logs:",d),l([]),p(!1)}finally{v(!1)}},[u,x,m]);s.useEffect(()=>{l([]),h(1),p(!0)},[S,u,x,m]),s.useEffect(()=>{_(j)},[j,_]),M(N,()=>{b&&!i&&h(t=>t+1)},b,i);const r=n.filter(t=>(t.user?.name??"").toLowerCase().includes(S.toLowerCase())).filter(t=>m==="online"?t.end_time===null:m==="offline"?t.end_time!==null:!0),a=(t,d)=>{if(!t)return"--";const g=new Date(t),f=(d?new Date(d):new Date)-g,F=Math.floor(f/6e4);if(F<1)return"0m";const $=Math.floor(F/60),R=F%60;return`${$>0?`${$}h `:""}${R}m`.trim()};s.useEffect(()=>{const t=setInterval(()=>{l(d=>[...d])},6e4);return()=>clearInterval(t)},[]);const o=Array.from(new Map(n.map(t=>[t.user?.id,t.user])).values()).sort((t,d)=>(t?.name??"").localeCompare(d?.name??""));return e.jsxs("div",{className:"flex flex-col h-full bg-white rounded shadow",children:[e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center w-full",children:[e.jsx("input",{type:"text",placeholder:"Search...",value:y,onChange:t=>L(t.target.value),className:"w-1/2 min-w-[250px] p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex flex-1 gap-4",children:[e.jsxs("select",{value:u,onChange:t=>D(t.target.value),className:"flex-1 p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Filter by User"}),o.map(t=>e.jsx("option",{value:t?.id,children:t?.name},t?.id))]}),e.jsx("input",{type:"date",value:x,onChange:t=>C(t.target.value),className:"flex-1 p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("select",{value:m,onChange:t=>w(t.target.value),className:"flex-1 p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"offline",children:"Offline"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-[1.2fr_1fr_1fr_0.8fr] items-center text-gray-600 font-medium text-sm border-y border-gray-200 bg-gray-100 py-3 px-8 select-none pr-12",children:[e.jsx("div",{className:"text-left",children:"User"}),e.jsx("div",{className:"text-left",children:"Date"}),e.jsx("div",{className:"text-left",children:"Time"}),e.jsx("div",{className:"text-right",children:"Duration"})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[!i&&r.length===0&&e.jsx("p",{className:"py-6 text-center text-gray-500",children:"No logs found"}),r.map((t,d)=>{const g=new Date(t.start_time),c=t.end_time?new Date(t.end_time):null;return e.jsxs("div",{className:"grid grid-cols-[1.2fr_1fr_1fr_0.8fr] items-center px-8 py-4 border-t border-gray-200 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3 py-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-full bg-violet-500 text-white font-semibold text-lg uppercase",children:t.user?.name?t.user.name.charAt(0):"?"}),!t.end_time&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"})]}),e.jsx("span",{className:"font-medium text-gray-800",children:t.user?.name??"N/A"})]}),e.jsxs("div",{className:"text-gray-700 text-sm",children:[e.jsx("div",{children:g.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}),e.jsx("div",{className:"text-xs text-gray-500",children:g.toLocaleDateString("en-US",{weekday:"long"})})]}),e.jsxs("div",{className:"text-gray-700 text-sm",children:[e.jsxs("div",{children:["Start"," ",g.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:["End"," ",t.end_time?c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--"]}),!t.end_time&&e.jsx("span",{className:"text-green-600 font-semibold ml-2",children:"Ongoing"})]})]}),e.jsx("div",{className:"text-gray-800 text-sm font-semibold text-right",children:a(t.start_time,t.end_time)})]},`log-${t.id??d}`)}),i&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:"Loading..."}),e.jsx("div",{ref:N,className:"h-10"})]})]})}function P(){const[n,l]=s.useState([]),[i,v]=s.useState(!1),[y,L]=s.useState(""),[u,D]=s.useState(""),[x,C]=s.useState(""),[m,w]=s.useState(1),[j,h]=s.useState(!0),b=s.useRef(),p=U(y,400),N=s.useCallback(async(r=1)=>{v(!0);try{const o=await I({user_id:u||void 0,date:x||void 0,page:r,limit:20});l(t=>r===1?o:[...t,...o]),h(o.length>0)}catch(a){console.error("Failed to fetch sales logs:",a),l([]),h(!1)}finally{v(!1)}},[u,x]);s.useEffect(()=>{l([]),w(1),h(!0)},[p,u,x]),s.useEffect(()=>{N(m)},[m,N]),M(b,()=>{j&&!i&&w(r=>r+1)},j,i);const S=n.filter(r=>(r.user?.name??"").toLowerCase().includes(p.toLowerCase())),_=Array.from(new Map(n.map(r=>[r.user?.id,r.user])).values()).sort((r,a)=>(r?.name??"").localeCompare(a?.name??""));return e.jsxs("div",{className:"flex flex-col h-full bg-white rounded shadow",children:[e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center w-full",children:[e.jsx("input",{type:"text",placeholder:"Search...",value:y,onChange:r=>L(r.target.value),className:"w-1/2 min-w-[250px] p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex flex-1 gap-4",children:[e.jsxs("select",{value:u,onChange:r=>D(r.target.value),className:"flex-1 p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Filter by User"}),_.map(r=>e.jsx("option",{value:r?.id,children:r?.name},r?.id))]}),e.jsx("input",{type:"date",value:x,onChange:r=>C(r.target.value),className:"flex-1 p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})}),e.jsxs("div",{className:"grid grid-cols-[1fr_1fr_0.5fr_0.5fr] items-center text-gray-600 font-medium text-sm border-y border-gray-200 bg-gray-100 py-3 px-8 select-none pr-14",children:[e.jsx("div",{className:"text-left",children:"Details"}),e.jsx("div",{className:"text-left",children:"Item Name"}),e.jsx("div",{className:"text-left",children:"Quantity"}),e.jsx("div",{className:"text-right",children:"Subtotal"})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[S.map((r,a)=>{const o=r.sale_items??[],t=new Date(r.created_at??Date.now()),d=o.reduce((c,f)=>c+(f.quantity??f.snapshot_quantity??0),0),g=o.reduce((c,f)=>c+parseFloat(f.subtotal??0),0);return e.jsxs("div",{className:"grid grid-cols-[1fr_1fr_0.5fr_0.5fr] border-t border-gray-200 hover:bg-gray-50 px-8 py-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-full bg-violet-500 text-white font-semibold text-lg uppercase",children:r.user?.name?r.user.name.charAt(0):"?"}),e.jsxs("div",{className:"flex flex-col text-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold",children:r.user?.name??"Unknown User"}),e.jsx("span",{className:"text-gray-500 text-sm",children:t.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}),e.jsx("span",{className:"text-gray-400 text-sm",children:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"mt-1 text-sm text-gray-600",children:[d," items"]}),e.jsxs("div",{className:"text-green-600 font-semibold text-sm",children:["Total: ₱",g.toFixed(2)]})]})]}),e.jsx("div",{className:"flex flex-col justify-start text-gray-700 text-sm",children:o.map((c,f)=>e.jsx("div",{className:"leading-6",children:c.product?.name??c.snapshot_name??"Deleted Product"},`item-name-${f}`))}),e.jsx("div",{className:"flex flex-col justify-start text-gray-700 text-sm",children:o.map((c,f)=>e.jsx("div",{className:"leading-6",children:c.quantity??c.snapshot_quantity??0},`item-qty-${f}`))}),e.jsx("div",{className:"flex flex-col items-end text-gray-700 text-sm pr-4",children:o.map((c,f)=>e.jsxs("div",{className:"leading-6",children:["₱",parseFloat(c.subtotal??0).toFixed(2)]},`item-sub-${f}`))})]},`sale-${r.id??a}`)}),i&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:"Loading..."}),e.jsx("div",{ref:b,className:"h-10"})]})]})}function O(){const[n,l]=s.useState([]),[i,v]=s.useState(!1),[y,L]=s.useState(""),[u,D]=s.useState(""),[x,C]=s.useState(""),[m,w]=s.useState(1),[j,h]=s.useState(!0),b=s.useRef(),p=U(y,400),N=s.useCallback(async(a=1)=>{v(!0);try{const t=await T({search:p||void 0,action:u||void 0,date:x||void 0,page:a,limit:20});l(d=>a===1?t:[...d,...t]),h(t.length>0)}catch(o){console.error("❌ Failed to fetch logs:",o),l([]),h(!1)}finally{v(!1)}},[p,u,x]);s.useEffect(()=>{l([]),w(1),h(!0)},[p,u,x]),s.useEffect(()=>{N(m)},[m,N]),M(b,()=>{j&&!i&&w(a=>a+1)},j,i);const S=[{value:"",label:"All Actions"},{value:"created",label:"Created"},{value:"update",label:"Updated"},{value:"restock",label:"Restocked"},{value:"deducted",label:"Deducted"},{value:"deleted",label:"Deleted"},{value:"adjusted",label:"Adjusted"}],_=a=>{switch((a??"").toLowerCase()){case"created":return"text-green-600 font-semibold";case"update":return"text-blue-600 font-semibold";case"restock":return"text-emerald-600 font-semibold";case"deducted":return"text-orange-500 font-semibold";case"deleted":return"text-red-600 font-semibold";case"adjusted":return"text-gray-600 font-semibold";default:return"text-gray-700"}},r=a=>({created:"Added",update:"Updated",restock:"Restocked",deducted:"Deducted",deleted:"Removed",adjusted:"Adjusted"})[a?.toLowerCase()]??a??"N/A";return e.jsxs("div",{className:"flex flex-col h-full bg-white rounded shadow",children:[e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center w-full",children:[e.jsx("input",{type:"text",placeholder:"Search by product name...",value:y,onChange:a=>L(a.target.value),className:"w-1/2 min-w-[250px] p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex flex-1 gap-4",children:[e.jsx("select",{value:u,onChange:a=>D(a.target.value),className:"flex-1 p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:S.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx("input",{type:"date",value:x,onChange:a=>C(a.target.value),className:"flex-1 p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})}),e.jsxs("div",{className:"grid grid-cols-[1fr_1fr_0.5fr_0.5fr] items-center text-gray-600 font-medium text-sm border-y border-gray-200 bg-gray-100 py-3 px-8 select-none",children:[e.jsx("div",{className:"text-left",children:"Action"}),e.jsx("div",{className:"text-left",children:"Quantity"}),e.jsx("div",{className:"text-left",children:"Product"}),e.jsx("div",{className:"text-right",children:"Date & Time"})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[n.length===0&&!i&&e.jsx("p",{className:"py-6 text-center text-gray-500",children:"No inventory logs found"}),n.map((a,o)=>{const t=new Date(a.created_at);return e.jsxs("div",{className:"grid grid-cols-[1fr_1fr_0.5fr_0.5fr] border-t border-gray-200 hover:bg-gray-50 px-8 py-6",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:`capitalize ${_(a.action)}`,children:r(a.action)})}),e.jsx("div",{className:"flex items-center text-gray-800 text-sm",children:a.quantity_change??"-"}),e.jsx("div",{className:"flex items-center text-gray-800 text-sm",children:a.product_name??"N/A"}),e.jsxs("div",{className:"flex flex-col items-end text-gray-700 text-sm",children:[e.jsx("div",{children:t.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}),e.jsx("div",{className:"text-xs text-gray-500",children:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},a.id||o)}),i&&e.jsx("p",{className:"py-6 text-center text-gray-500",children:"Loading..."}),e.jsx("div",{ref:b,className:"h-10"})]})]})}const A=[{key:"time",label:"Time log"},{key:"sales",label:"Sales log"},{key:"inventory",label:"Inventory log"}],B=()=>{const[n,l]=s.useState("time");return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-4rem)] bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"relative flex justify-between border border-gray-200 rounded-t-lg overflow-hidden",children:[A.map(i=>e.jsx("button",{onClick:()=>l(i.key),className:`relative flex-1 py-3 text-center font-medium transition-colors duration-300 ${n===i.key?"text-black bg-fuchsia-50":"text-gray-400 hover:text-gray-600"}`,children:i.label},i.key)),e.jsx("div",{className:"absolute bottom-0 h-1 bg-fuchsia-600 rounded-t transition-all duration-300",style:{width:`${100/A.length}%`,left:`${A.findIndex(i=>i.key===n)*(100/A.length)}%`}})]}),e.jsxs("div",{className:"flex-1 overflow-auto border border-gray-200",children:[n==="time"&&e.jsx(q,{}),n==="sales"&&e.jsx(P,{}),n==="inventory"&&e.jsx(O,{})]})]})};export{B as default};
//# sourceMappingURL=RecordsContent-Dc8VqTSz.js.map
