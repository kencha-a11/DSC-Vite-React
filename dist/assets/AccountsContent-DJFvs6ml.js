import{A as E,r as l,j as e}from"./index-B99SmHNo.js";import{P as M}from"./PlusIcon-QjczJcfd.js";import{f as L}from"./formatPeso-BGd6Nsev.js";import{M as T}from"./MessageToast-CfSi4MnN.js";async function $(r={}){return(await E.get("/users",{params:r})).data}async function R(r){return(await E.post("/users",r)).data}function q(){const[r,i]=l.useState([]),[m,o]=l.useState(!1),[c,v]=l.useState(null),[p,t]=l.useState(1),[d,h]=l.useState(!0),[n,g]=l.useState(""),[f,b]=l.useState(0),s=l.useRef(),a=l.useCallback(async(x=1,N=!1)=>{if(m){console.log("â³ Already loading, skipping fetch");return}console.log("ðŸ“¦ Fetching users...",{pageToFetch:x,searchTerm:n}),o(!0),v(null);try{const j=await $({page:x,perPage:20,search:n||void 0});console.log("âœ… Response from API:",j);let w=[],U=!1,S=0;Array.isArray(j)?(w=j,U=!1,S=w.length):Array.isArray(j.data)&&(w=j.data,U=j.hasMore||!1,S=j.total||w.length),console.log("ðŸ”¹ Fetched users array:",w),i(C=>{if(console.log("ðŸ”¸ Previous users:",C),N||x===1)return console.log("ðŸ”¹ Replacing users with new fetch"),w;const D=new Set(C.map(k=>k.id)),P=w.filter(k=>!D.has(k.id));return console.log("ðŸ”¹ Appending new users:",P),[...C,...P]}),h(U),b(S),console.log("ðŸ“Š Updated state -> totalUsers:",S,"hasMore:",U)}catch(_){console.error("âŒ Failed to fetch users:",_),v(_.message||"Failed to load users"),i([]),h(!1)}finally{o(!1),console.log("â¹ Fetch complete, loading set to false")}},[n,m]);l.useEffect(()=>{console.log("ðŸ” Search term changed:",n),i([]),t(1),h(!0),a(1,!0)},[n]),l.useEffect(()=>{p>1&&(console.log("ðŸ“„ Page changed:",p),a(p))},[p]),l.useEffect(()=>{const x=new IntersectionObserver(_=>{_[0].isIntersecting&&d&&!m&&(console.log("ðŸ“œ Infinite scroll triggered, loading next page..."),t(w=>w+1))},{threshold:.1}),N=s.current;return N&&(x.observe(N),console.log("ðŸ‘€ Observer attached to loaderRef")),()=>{N&&(x.unobserve(N),console.log("ðŸš« Observer detached from loaderRef"))}},[d,m]);const y=l.useCallback(x=>{console.log("âž• Adding new user:",x),i(N=>{const j=[{...x,active_status:x.latest_time_log?.current_status==="Active"?"active":"inactive"},...N].sort((w,U)=>w.active_status===U.active_status?0:w.active_status==="active"?-1:1);return console.log("ðŸ”¹ Users after add:",j),j}),b(N=>N+1)},[]),u=l.useCallback(x=>{console.log("âœï¸ Updating user:",x),i(N=>{const _=N.map(j=>j.id===x.id?{...x,active_status:x.latest_time_log?.current_status==="Active"?"active":"inactive"}:j);return console.log("ðŸ”¹ Users after update:",_),_})},[]),A=l.useCallback(x=>{console.log("âœï¸ Search handler called:",x),g(x)},[]);return console.log("ðŸ“ Hook state -> users:",r,"loading:",m,"totalUsers:",f),{users:r,loading:m,error:c,hasMore:d,totalUsers:f,searchTerm:n,loaderRef:s,handleSearch:A,handleUserAdded:y,handleUserUpdated:u,refetch:()=>{console.log("ðŸ”„ Refetch triggered"),i([]),t(1),a(1,!0)}}}function F({onClose:r,onUserAdded:i,onToast:m}){const[o,c]=l.useState({first_name:"",last_name:"",email:"",password:"",role:"user",account_status:"activated",phone_number:""}),[v,p]=l.useState(!1),t=h=>{const{name:n,value:g}=h.target;c(f=>({...f,[n]:g}))},d=async h=>{h.preventDefault();try{p(!0);const n=await R(o);i(n),m?.({type:"success",text:"User created successfully!"}),r()}catch(n){console.error("Error adding user:",n),m?.({type:"error",text:"Failed to create user."})}finally{p(!1)}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/40 z-50",children:e.jsx("div",{className:"bg-white rounded-xl w-[480px] shadow-lg border-2 border-purple-600",children:e.jsxs("form",{onSubmit:d,className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Add Account"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Firstname"}),e.jsx("input",{type:"text",name:"first_name",value:o.first_name,onChange:t,placeholder:"Placeholder",className:"w-full border border-purple-600 rounded-md px-3 py-2 mt-1 focus:ring-2 focus:ring-purple-200",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Lastname"}),e.jsx("input",{type:"text",name:"last_name",value:o.last_name,onChange:t,placeholder:"Placeholder",className:"w-full border border-purple-600 rounded-md px-3 py-2 mt-1 focus:ring-2 focus:ring-purple-200",required:!0})]})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Email"}),e.jsx("input",{type:"email",name:"email",value:o.email,onChange:t,placeholder:"Placeholder",className:"w-full border border-purple-600 rounded-md px-3 py-2 mt-1 focus:ring-2 focus:ring-purple-200",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Password"}),e.jsx("input",{type:"password",name:"password",value:o.password,onChange:t,placeholder:"Placeholder",className:"w-full border border-purple-600 rounded-md px-3 py-2 mt-1 focus:ring-2 focus:ring-purple-200",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Role"}),e.jsxs("select",{name:"role",value:o.role,onChange:t,className:"w-full border border-purple-600 rounded-md px-3 py-2 mt-1 focus:ring-2 focus:ring-purple-200 bg-white",required:!0,children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"manager",children:"Manager"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Account Status"}),e.jsxs("select",{name:"account_status",value:o.account_status,onChange:t,className:"w-full border border-purple-600 rounded-md px-3 py-2 mt-1 focus:ring-2 focus:ring-purple-200 bg-white",children:[e.jsx("option",{value:"activated",children:"Activated"}),e.jsx("option",{value:"deactivated",children:"Deactivated"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsx("input",{type:"text",name:"phone_number",value:o.phone_number,onChange:t,placeholder:"Placeholder",className:"w-full border border-purple-600 rounded-md px-3 py-2 mt-1 focus:ring-2 focus:ring-purple-200"})]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-4 mt-6",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 border rounded-md text-gray-500 hover:bg-gray-100",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:v,className:"px-4 py-2 rounded-md bg-purple-600 text-white hover:bg-purple-700 disabled:opacity-50",children:v?"Saving...":"Confirm"})]})]})})})}function I({users:r=[],loading:i=!1,loaderRef:m,onSelectUser:o,onToast:c,onSearch:v,onUserAdded:p,searchTerm:t=""}){const[d,h]=l.useState(!1),n=s=>{const a=s.target.value;v?.(a)},g=s=>{p?.(s),c?.("User added successfully!")},f=Array.isArray(r)?[...r].sort((s,a)=>{const y=s.latest_time_log?.current_status?.toLowerCase()||"inactive",u=a.latest_time_log?.current_status?.toLowerCase()||"inactive";return y===u?0:y==="active"||y==="logged_in"?-1:1}):[],b=f.length>0;return e.jsxs("div",{className:"flex flex-col h-full bg-white rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("input",{type:"text",placeholder:"Search accounts",value:t,onChange:n,className:"flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-pink-500 transition duration-150 ease-in-out"}),e.jsxs("button",{onClick:()=>h(!0),className:"ml-4 flex items-center bg-green-600 text-white px-3 py-2 rounded-lg text-sm font-semibold shadow-md hover:bg-green-700 transition duration-150 ease-in-out",children:[e.jsx(M,{className:"w-5 h-5 mr-2"}),"Add Account"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:i&&!b?e.jsx("div",{className:"text-center py-10 text-gray-400",children:"Loading users..."}):b?e.jsxs(e.Fragment,{children:[f.map(s=>{const a=s.name||`${s.first_name||""} ${s.last_name||""}`.trim()||"Unnamed User",y=s.first_name?.charAt(0)?.toUpperCase?.()||s.last_name?.charAt(0)?.toUpperCase?.()||a?.charAt(0)?.toUpperCase?.()||"?",u=s.latest_time_log?.current_status||"Inactive",A=u.toLowerCase()==="active"||u.toLowerCase()==="logged_in";return e.jsxs("div",{onClick:()=>o?.(s),className:"flex items-center justify-between p-4 border-b last:border-b-0 border-gray-100 cursor-pointer hover:bg-gray-50 transition duration-150 ease-in-out",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center font-semibold text-gray-600",children:y}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-800 font-medium",children:a}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email||"-"})]})]}),A&&e.jsx("div",{className:"text-xs px-3 py-1 font-medium rounded-full bg-green-100 text-green-700",children:"Active"})]},s.id)}),i&&e.jsx("div",{className:"text-center py-4 text-gray-500 text-sm",children:"Loading more users..."}),e.jsx("div",{ref:m,className:"h-4"})]}):e.jsx("div",{className:"text-center py-10 text-gray-400",children:t?`No users found for "${t}"`:"No users found"})}),d&&e.jsx(F,{onClose:()=>h(!1),onUserAdded:g,onToast:c})]})}function W({user:r,onClose:i,onUserUpdated:m,onToast:o}){const[c,v]=l.useState({first_name:r.first_name||"",last_name:r.last_name||"",email:r.email||"",password:"",role:r.role||"user",account_status:r.account_status||"activated",phone_number:r.phone_number||""}),[p,t]=l.useState(!1),d=n=>{const{name:g,value:f}=n.target;v(b=>({...b,[g]:f}))},h=async n=>{n.preventDefault();try{t(!0);const g=await E.put(`/users/${r.id}`,c);m(g.data),o?.({type:"success",text:"User updated successfully!"}),i()}catch(g){console.error("Error updating user:",g),o?.({type:"error",text:"Failed to update user."})}finally{t(!1)}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/40 z-50",children:e.jsx("div",{className:"bg-white rounded-xl w-[480px] shadow-lg border-2 border-purple-600",children:e.jsxs("form",{onSubmit:h,children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 p-4 border-b border-gray-200",children:"Edit User Profile"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"First Name"}),e.jsx("input",{type:"text",name:"first_name",value:c.first_name,onChange:d,placeholder:"Enter first name",className:"w-full border border-purple-600 rounded-md px-3 py-2 mt-1 focus:ring-2 focus:ring-purple-200",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Last Name"}),e.jsx("input",{type:"text",name:"last_name",value:c.last_name,onChange:d,placeholder:"Enter last name",className:"w-full border border-purple-600 rounded-md px-3 py-2 mt-1 focus:ring-2 focus:ring-purple-200",required:!0})]})]}),e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Email"}),e.jsx("input",{type:"email",name:"email",value:c.email,onChange:d,placeholder:"Enter email",className:"w-full border border-purple-600 rounded-md px-3 py-2 mt-1 focus:ring-2 focus:ring-purple-200",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700",children:["Password ",e.jsx("span",{className:"text-gray-400 text-xs",children:"(leave blank to keep current)"})]}),e.jsx("input",{type:"password",name:"password",value:c.password,onChange:d,placeholder:"Enter new password",className:"w-full border border-purple-600 rounded-md px-3 py-2 mt-1 focus:ring-2 focus:ring-purple-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Role"}),e.jsxs("select",{name:"role",value:c.role,onChange:d,className:"w-full border border-purple-600 rounded-md px-3 py-2 mt-1 bg-white focus:ring-2 focus:ring-purple-200",required:!0,children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"manager",children:"Manager"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Account Status"}),e.jsxs("select",{name:"account_status",value:c.account_status,onChange:d,className:"w-full border border-purple-600 rounded-md px-3 py-2 mt-1 bg-white focus:ring-2 focus:ring-purple-200",children:[e.jsx("option",{value:"activated",children:"Activated"}),e.jsx("option",{value:"deactivated",children:"Deactivated"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsx("input",{type:"text",name:"phone_number",value:c.phone_number,onChange:d,placeholder:"Enter phone number",className:"w-full border border-purple-600 rounded-md px-3 py-2 mt-1 focus:ring-2 focus:ring-purple-200"})]})]}),e.jsxs("div",{className:"flex justify-between border-t border-gray-200 p-4 mt-4",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 bg-gray-200 rounded-md text-gray-500 hover:bg-gray-100",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:p,className:"px-4 py-2 rounded-md bg-purple-600 text-white hover:bg-purple-700 disabled:opacity-50",children:p?"Saving...":"Confirm"})]})]})})})}function O({selectedUser:r,onToast:i,onUserUpdated:m}){const[o,c]=l.useState("Time log"),[v,p]=l.useState(!1),[t,d]=l.useState(null);if(l.useEffect(()=>{d(r||null)},[r]),!t)return e.jsx("div",{className:"w-full h-full bg-white shadow-lg border border-gray-200 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"Select a user to view logs"})});const h=s=>{d(s),m?.(s)},n=`${t.first_name||""} ${t.last_name||""}`.trim()||"Unnamed User",g=t.first_name?.charAt(0)?.toUpperCase()||t.last_name?.charAt(0)?.toUpperCase()||"?",f=Array.isArray(t.time_logs)?[...t.time_logs].sort((s,a)=>new Date(a.start_time)-new Date(s.start_time)):[],b=Array.isArray(t.sales_logs)?[...t.sales_logs].sort((s,a)=>new Date(`${a.date||""} ${a.time||""}`)-new Date(`${s.date||""} ${s.time||""}`)):[];return e.jsxs("div",{className:"w-full h-full bg-white shadow-lg border border-gray-200 flex flex-col",children:[e.jsxs("div",{className:"shrink-0 p-6 pb-4 border-b border-gray-200",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-300 rounded-full shrink-0 flex items-center justify-center text-2xl font-semibold text-gray-600",children:g}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:n}),e.jsx("p",{className:"text-sm text-gray-500",children:t.email||"-"}),e.jsx("p",{className:"text-sm text-gray-500",children:t.phone_number||"-"}),t.latest_time_log?.current_status&&e.jsx("p",{className:`text-sm font-semibold ${t.latest_time_log.current_status==="Active"?"text-green-600":"text-gray-500"}`,children:t.latest_time_log.current_status})]})]})}),e.jsx("button",{onClick:()=>p(!0),className:"mt-4 w-full bg-gray-100 hover:bg-gray-200 text-gray-800 py-2 rounded-lg text-sm font-medium transition",children:"Edit profile"})]}),e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex shrink-0 bg-gray-50 border-b border-gray-200",children:["Time log","Sales log"].map(s=>e.jsx("button",{onClick:()=>c(s),className:`flex-1 py-3 text-sm font-medium transition duration-150 ease-in-out ${o===s?"bg-white border-b-2 border-black text-black":"text-gray-500 hover:bg-gray-100"}`,children:s},s))}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 pt-4",children:o==="Time log"?f.length===0?e.jsx("p",{className:"text-center text-gray-500 pt-8",children:"No time log entries found."}):f.map(s=>{const a=s.start_time?new Date(s.start_time):null,y=s.end_time?new Date(s.end_time):null,u=a?.toLocaleDateString(void 0,{weekday:"long"})||"-";return e.jsxs("div",{className:"flex justify-between items-center py-4 border-b last:border-b-0 border-gray-100",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:a?.toLocaleDateString()||"-"}),e.jsx("p",{className:"text-xs text-gray-500",children:u})]}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Start"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:a?a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"-"})]}),e.jsxs("div",{className:"flex-1 text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"End"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:y?y.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"-"})]})]},s.id)}):b.length===0?e.jsx("p",{className:"text-center text-gray-500 pt-8",children:"No sales log entries found."}):b.map(s=>e.jsxs("div",{className:"py-4 border-b last:border-b-0 border-gray-100 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("div",{className:"flex-1 text-xs text-gray-500 space-y-1",children:Array.isArray(s.sale_items)&&s.sale_items.length>0?s.sale_items.map((a,y)=>e.jsxs("p",{children:[a.snapshot_name||"Unknown Product"," Ã— ",a.snapshot_quantity||0," @"," ",L(a.snapshot_price||0)]},y)):e.jsx("p",{className:"text-xs text-orange-600 italic",children:"Product details unavailable"})}),e.jsxs("div",{className:"flex flex-col items-end text-right ml-4",children:[e.jsx("span",{className:"text-sm text-gray-900 font-semibold",children:s.time||"-"}),e.jsx("span",{className:"text-xs text-gray-500",children:s.date||"-"})]})]}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx("p",{className:"text-sm font-bold text-green-600",children:L(s.total||0)})})]},s.id))})]}),v&&e.jsx(W,{user:t,onClose:()=>p(!1),onUserUpdated:h,onToast:i})]})}function J(){const{users:r=[],loading:i,error:m,totalUsers:o,searchTerm:c,loaderRef:v,handleSearch:p,handleUserAdded:t,handleUserUpdated:d}=q(),[h,n]=l.useState(null),[g,f]=l.useState(null),b=u=>f(u),s=u=>{console.log("ðŸ‘¤ User selected:",u),n(u)},a=u=>{t(u),b("User added successfully!")},y=u=>{d(u),h?.id===u.id&&n(u),b("User updated successfully!")};return m?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("p",{className:"text-red-600",children:["Error loading accounts: ",m]})}):e.jsxs("div",{className:"flex flex-col h-[90vh] w-full overflow-hidden bg-gray-50 relative",children:[e.jsx("div",{className:"px-4 py-2 bg-white border-b border-gray-200",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Total Users: ",e.jsx("span",{className:"font-semibold",children:o})]})}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx("div",{className:"flex-2 flex flex-col overflow-hidden",children:e.jsx("div",{className:"flex-1 overflow-y-auto px-4 pt-4",children:e.jsx(I,{users:Array.isArray(r)?r:[],loading:i,loaderRef:v,searchTerm:c,onSelectUser:s,onToast:b,onSearch:p,onUserAdded:a})})}),e.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto border-l border-gray-200",children:e.jsx(O,{selectedUser:h,onToast:b,onUserUpdated:y})})]}),g&&e.jsx(T,{message:g,onClose:()=>f(null),duration:1500})]})}export{J as default};
//# sourceMappingURL=AccountsContent-DJFvs6ml.js.map
