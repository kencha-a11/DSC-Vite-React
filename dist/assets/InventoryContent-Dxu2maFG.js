import{S as pe,p as le,d as I,s as V,e as B,n as G,i as Z,f as ce,t as Se,g as H,h as _e,k as Ee,l as de,m as J,o as ue,q as Me,v as Oe,w as he,x as Le,r as l,y as ye,z as U,j as e,A as te}from"./index-Bc5vGLNC.js";import{P as be}from"./PlusIcon-D4a-e0KS.js";import{M as ve}from"./MessageToast-B-aHVe4G.js";import{g as Fe,u as Ie,d as De,r as Te,a as Ue,c as Qe,b as Ae}from"./productServices-Dovje8SO.js";import{u as ze}from"./useDebounce-CTZPZD1f.js";import{u as se}from"./useInfiniteScroll-FbNpnltE.js";var qe=class extends pe{constructor(t,s){super(),this.options=s,this.#s=t,this.#i=null,this.#n=le(),this.bindMethods(),this.setOptions(s)}#s;#e=void 0;#r=void 0;#t=void 0;#a;#o;#n;#i;#f;#h;#m;#c;#d;#l;#g=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#e.addObserver(this),me(this.#e,this.options)?this.#u():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ee(this.#e,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ee(this.#e,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#j(),this.#e.removeObserver(this)}setOptions(t){const s=this.options,a=this.#e;if(this.options=this.#s.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof I(this.options.enabled,this.#e)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#e.setOptions(this.options),s._defaulted&&!V(this.options,s)&&this.#s.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#e,observer:this});const r=this.hasListeners();r&&ge(this.#e,a,this.options,s)&&this.#u(),this.updateResult(),r&&(this.#e!==a||I(this.options.enabled,this.#e)!==I(s.enabled,this.#e)||B(this.options.staleTime,this.#e)!==B(s.staleTime,this.#e))&&this.#x();const o=this.#p();r&&(this.#e!==a||I(this.options.enabled,this.#e)!==I(s.enabled,this.#e)||o!==this.#l)&&this.#y(o)}getOptimisticResult(t){const s=this.#s.getQueryCache().build(this.#s,t),a=this.createResult(s,t);return Be(this,a)&&(this.#t=a,this.#o=this.options,this.#a=this.#e.state),a}getCurrentResult(){return this.#t}trackResult(t,s){return new Proxy(t,{get:(a,r)=>(this.trackProp(r),s?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#n.status==="pending"&&this.#n.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(a,r))})}trackProp(t){this.#g.add(t)}getCurrentQuery(){return this.#e}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const s=this.#s.defaultQueryOptions(t),a=this.#s.getQueryCache().build(this.#s,s);return a.fetch().then(()=>this.createResult(a,s))}fetch(t){return this.#u({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#t))}#u(t){this.#w();let s=this.#e.fetch(this.options,t);return t?.throwOnError||(s=s.catch(G)),s}#x(){this.#v();const t=B(this.options.staleTime,this.#e);if(Z||this.#t.isStale||!ce(t))return;const a=Se(this.#t.dataUpdatedAt,t)+1;this.#c=H.setTimeout(()=>{this.#t.isStale||this.updateResult()},a)}#p(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#e):this.options.refetchInterval)??!1}#y(t){this.#j(),this.#l=t,!(Z||I(this.options.enabled,this.#e)===!1||!ce(this.#l)||this.#l===0)&&(this.#d=H.setInterval(()=>{(this.options.refetchIntervalInBackground||_e.isFocused())&&this.#u()},this.#l))}#b(){this.#x(),this.#y(this.#p())}#v(){this.#c&&(H.clearTimeout(this.#c),this.#c=void 0)}#j(){this.#d&&(H.clearInterval(this.#d),this.#d=void 0)}createResult(t,s){const a=this.#e,r=this.options,o=this.#t,n=this.#a,i=this.#o,u=t!==a?t.state:this.#r,{state:x}=t;let m={...x},g=!1,c;if(s._optimisticResults){const v=this.hasListeners(),S=!v&&me(t,s),N=v&&ge(t,a,s,r);(S||N)&&(m={...m,...Ee(x.data,t.options)}),s._optimisticResults==="isRestoring"&&(m.fetchStatus="idle")}let{error:b,errorUpdatedAt:w,status:C}=m;c=m.data;let R=!1;if(s.placeholderData!==void 0&&c===void 0&&C==="pending"){let v;o?.isPlaceholderData&&s.placeholderData===i?.placeholderData?(v=o.data,R=!0):v=typeof s.placeholderData=="function"?s.placeholderData(this.#m?.state.data,this.#m):s.placeholderData,v!==void 0&&(C="success",c=de(o?.data,v,s),g=!0)}if(s.select&&c!==void 0&&!R)if(o&&c===n?.data&&s.select===this.#f)c=this.#h;else try{this.#f=s.select,c=s.select(c),c=de(o?.data,c,s),this.#h=c,this.#i=null}catch(v){this.#i=v}this.#i&&(b=this.#i,c=this.#h,w=Date.now(),C="error");const _=m.fetchStatus==="fetching",k=C==="pending",y=C==="error",f=k&&_,p=c!==void 0,h={status:C,fetchStatus:m.fetchStatus,isPending:k,isSuccess:C==="success",isError:y,isInitialLoading:f,isLoading:f,data:c,dataUpdatedAt:m.dataUpdatedAt,error:b,errorUpdatedAt:w,failureCount:m.fetchFailureCount,failureReason:m.fetchFailureReason,errorUpdateCount:m.errorUpdateCount,isFetched:m.dataUpdateCount>0||m.errorUpdateCount>0,isFetchedAfterMount:m.dataUpdateCount>u.dataUpdateCount||m.errorUpdateCount>u.errorUpdateCount,isFetching:_,isRefetching:_&&!k,isLoadingError:y&&!p,isPaused:m.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:y&&p,isStale:re(t,s),refetch:this.refetch,promise:this.#n,isEnabled:I(s.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const v=P=>{h.status==="error"?P.reject(h.error):h.data!==void 0&&P.resolve(h.data)},S=()=>{const P=this.#n=h.promise=le();v(P)},N=this.#n;switch(N.status){case"pending":t.queryHash===a.queryHash&&v(N);break;case"fulfilled":(h.status==="error"||h.data!==N.value)&&S();break;case"rejected":(h.status!=="error"||h.error!==N.reason)&&S();break}}return h}updateResult(){const t=this.#t,s=this.createResult(this.#e,this.options);if(this.#a=this.#e.state,this.#o=this.options,this.#a.data!==void 0&&(this.#m=this.#e),V(s,t))return;this.#t=s;const a=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,o=typeof r=="function"?r():r;if(o==="all"||!o&&!this.#g.size)return!0;const n=new Set(o??this.#g);return this.options.throwOnError&&n.add("error"),Object.keys(this.#t).some(i=>{const d=i;return this.#t[d]!==t[d]&&n.has(d)})};this.#C({listeners:a()})}#w(){const t=this.#s.getQueryCache().build(this.#s,this.options);if(t===this.#e)return;const s=this.#e;this.#e=t,this.#r=t.state,this.hasListeners()&&(s?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#C(t){J.batch(()=>{t.listeners&&this.listeners.forEach(s=>{s(this.#t)}),this.#s.getQueryCache().notify({query:this.#e,type:"observerResultsUpdated"})})}};function $e(t,s){return I(s.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&s.retryOnMount===!1)}function me(t,s){return $e(t,s)||t.state.data!==void 0&&ee(t,s,s.refetchOnMount)}function ee(t,s,a){if(I(s.enabled,t)!==!1&&B(s.staleTime,t)!=="static"){const r=typeof a=="function"?a(t):a;return r==="always"||r!==!1&&re(t,s)}return!1}function ge(t,s,a,r){return(t!==s||I(r.enabled,t)===!1)&&(!a.suspense||t.state.status!=="error")&&re(t,a)}function re(t,s){return I(s.enabled,t)!==!1&&t.isStaleByTime(B(s.staleTime,t))}function Be(t,s){return!V(t.getCurrentResult(),s)}var Ke=class extends qe{constructor(t,s){super(t,s)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t){super.setOptions({...t,behavior:ue()})}getOptimisticResult(t){return t.behavior=ue(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,s){const{state:a}=t,r=super.createResult(t,s),{isFetching:o,isRefetching:n,isError:i,isRefetchError:d}=r,u=a.fetchMeta?.fetchMore?.direction,x=i&&u==="forward",m=o&&u==="forward",g=i&&u==="backward",c=o&&u==="backward";return{...r,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:Oe(s,a.data),hasPreviousPage:Me(s,a.data),isFetchNextPageError:x,isFetchingNextPage:m,isFetchPreviousPageError:g,isFetchingPreviousPage:c,isRefetchError:d&&!x&&!g,isRefetching:n&&!m&&!c}}},We=class extends pe{#s;#e=void 0;#r;#t;constructor(t,s){super(),this.#s=t,this.setOptions(s),this.bindMethods(),this.#a()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const s=this.options;this.options=this.#s.defaultMutationOptions(t),V(this.options,s)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),s?.mutationKey&&this.options.mutationKey&&he(s.mutationKey)!==he(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(t){this.#a(),this.#o(t)}getCurrentResult(){return this.#e}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#a(),this.#o()}mutate(t,s){return this.#t=s,this.#r?.removeObserver(this),this.#r=this.#s.getMutationCache().build(this.#s,this.options),this.#r.addObserver(this),this.#r.execute(t)}#a(){const t=this.#r?.state??Le();this.#e={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#o(t){J.batch(()=>{if(this.#t&&this.hasListeners()){const s=this.#e.variables,a=this.#e.context,r={client:this.#s,meta:this.options.meta,mutationKey:this.options.mutationKey};t?.type==="success"?(this.#t.onSuccess?.(t.data,s,a,r),this.#t.onSettled?.(t.data,null,s,a,r)):t?.type==="error"&&(this.#t.onError?.(t.error,s,a,r),this.#t.onSettled?.(void 0,t.error,s,a,r))}this.listeners.forEach(s=>{s(this.#e)})})}},je=l.createContext(!1),He=()=>l.useContext(je);je.Provider;function Ve(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Ge=l.createContext(Ve()),Je=()=>l.useContext(Ge),Xe=(t,s)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(s.isReset()||(t.retryOnMount=!1))},Ye=t=>{l.useEffect(()=>{t.clearReset()},[t])},Ze=({result:t,errorResetBoundary:s,throwOnError:a,query:r,suspense:o})=>t.isError&&!s.isReset()&&!t.isFetching&&r&&(o&&t.data===void 0||ye(a,[t.error,r])),et=t=>{if(t.suspense){const a=o=>o==="static"?o:Math.max(o??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...o)=>a(r(...o)):a(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},tt=(t,s)=>t.isLoading&&t.isFetching&&!s,st=(t,s)=>t?.suspense&&s.isPending,fe=(t,s,a)=>s.fetchOptimistic(t).catch(()=>{a.clearReset()});function rt(t,s,a){const r=He(),o=Je(),n=U(),i=n.defaultQueryOptions(t);n.getDefaultOptions().queries?._experimental_beforeQuery?.(i),i._optimisticResults=r?"isRestoring":"optimistic",et(i),Xe(i,o),Ye(o);const d=!n.getQueryCache().get(i.queryHash),[u]=l.useState(()=>new s(n,i)),x=u.getOptimisticResult(i),m=!r&&t.subscribed!==!1;if(l.useSyncExternalStore(l.useCallback(g=>{const c=m?u.subscribe(J.batchCalls(g)):G;return u.updateResult(),c},[u,m]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),l.useEffect(()=>{u.setOptions(i)},[i,u]),st(i,x))throw fe(i,u,o);if(Ze({result:x,errorResetBoundary:o,throwOnError:i.throwOnError,query:n.getQueryCache().get(i.queryHash),suspense:i.suspense}))throw x.error;return n.getDefaultOptions().queries?._experimental_afterQuery?.(i,x),i.experimental_prefetchInRender&&!Z&&tt(x,r)&&(d?fe(i,u,o):n.getQueryCache().get(i.queryHash)?.promise)?.catch(G).finally(()=>{u.updateResult()}),i.notifyOnChangeProps?x:u.trackResult(x)}function q(t,s){const a=U(),[r]=l.useState(()=>new We(a,t));l.useEffect(()=>{r.setOptions(t)},[r,t]);const o=l.useSyncExternalStore(l.useCallback(i=>r.subscribe(J.batchCalls(i)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),n=l.useCallback((i,d)=>{r.mutate(i,d).catch(G)},[r]);if(o.error&&ye(r.options.throwOnError,[o.error]))throw o.error;return{...o,mutate:n,mutateAsync:o.mutate}}function at(t,s){return rt(t,Ke)}const ot=({className:t="w-5 h-5",strokeWidth:s=2})=>e.jsxs("svg",{className:t,fill:"currentColor",stroke:"none",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"5",r:"2"}),e.jsx("circle",{cx:"12",cy:"12",r:"2"}),e.jsx("circle",{cx:"12",cy:"19",r:"2"})]}),nt=({className:t="w-5 h-5"})=>e.jsx("svg",{className:t,viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:e.jsx("path",{d:"M5 12h14",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})}),it=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8 mb-2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),lt=({className:t="w-4 h-4"})=>e.jsx("svg",{className:t,viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M6 6l12 12M6 18L18 6",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})});function ct({searchInput:t,setState:s,dropdownOpen:a,setDropdownOpen:r}){const o=l.useRef(null);return l.useEffect(()=>{function n(i){o.current&&!o.current.contains(i.target)&&a&&r(!1)}return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[a,r]),e.jsxs("div",{className:"flex items-center p-4 shrink-0 relative",children:[e.jsx("div",{className:"flex-1 relative",children:e.jsx("input",{type:"text",placeholder:"Search products",value:t,onChange:n=>s("searchInput",n.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-pink-500"})}),e.jsxs("div",{className:"ml-4 relative",ref:o,children:[e.jsxs("button",{onClick:()=>r(!a),className:"bg-blue-800 text-white px-4 py-2 rounded-lg hover:bg-blue-950 flex items-center gap-1",children:["Manage Inventory",e.jsx(be,{className:"w-4 h-4"})]}),a&&e.jsx("div",{className:"absolute right-0 mt-2 w-44 bg-white border rounded shadow-lg z-10",children:[{label:"+ Products",action:"showCreateProduct"},{label:"+ Category",action:"showCreateCategory"},{label:"- Category",action:"showRemoveCategory"},{label:"- Products",action:"showRemoveProducts"}].map(({label:n,action:i})=>e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100",onClick:()=>{s(i,!0),r(!1)},children:n},n))})]})]})}function dt({selectedCategory:t,statusFilter:s,setState:a,categories:r}){return e.jsx("div",{className:"border-y border-gray-200 bg-gray-100 py-3 select-none",children:e.jsxs("div",{className:"grid grid-cols-[80px_2fr_120px_1fr_1.5fr_1fr_80px] items-center text-gray-600 font-medium text-sm px-8",children:[e.jsx("div",{children:"Image"}),e.jsx("div",{children:"Product Name"}),e.jsx("div",{children:"Price"}),e.jsx("div",{children:"Quantity"}),e.jsx("select",{value:t,onChange:o=>a("selectedCategory",o.target.value),className:"border rounded px-2 py-1 text-sm bg-white mr-2",children:r.map(o=>e.jsx("option",{value:o.category_name,children:o.category_name},o.id))}),e.jsxs("select",{value:s,onChange:o=>{const n=o.target.value.toLowerCase();console.log("Status selected:",n),a("statusFilter",n)},className:"border rounded px-2 py-1 text-sm bg-white",children:[e.jsx("option",{value:"",children:"Status"}),["stock","low stock","out of stock"].map(o=>e.jsx("option",{value:o.toLowerCase(),children:o},o))]}),e.jsx("div",{className:"text-right",children:"Actions"})]})})}function we({isOpen:t,onClose:s,title:a,children:r,maxWidth:o="2xl"}){if(!t)return null;const n={sm:"max-w-sm",md:"max-w-md",lg:"max-w-lg",xl:"max-w-xl","2xl":"max-w-2xl","4xl":"max-w-4xl"};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:s}),e.jsxs("div",{className:`relative z-50 w-[112vh]  h-[58vh] ${n[o]} bg-white shadow-xl border-2 border-purple-500 rounded-lg max-h-[90vh] overflow-y-auto`,children:[a&&e.jsx("div",{className:"border-b border-gray-200 p-4",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:a})}),e.jsx("div",{className:"",children:r})]})]})}function ut({product:t,categories:s,isOpen:a,onClose:r,onSuccess:o}){const[n,i]=l.useState({name:t?.name||"",category_ids:t?.categories?.map(f=>f.id)||[],price:t?.price||"",low_stock_threshold:t?.low_stock_threshold||10,image:null}),[d,u]=l.useState(!1),[x,m]=l.useState(t?.image_url||""),[g,c]=l.useState(!1),b=l.useRef(null);l.useEffect(()=>{a&&t&&(i({name:t.name,category_ids:t.categories?.map(f=>f.id)||[],price:t.price,low_stock_threshold:t.low_stock_threshold||10,image:null}),m(t.image_url||""))},[a,t]),l.useEffect(()=>{const f=p=>{b.current&&!b.current.contains(p.target)&&c(!1)};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]);const w=(f,p)=>{i(j=>({...j,[f]:p}))},C=f=>{const p=f.target.files[0];p&&(i(j=>({...j,image:p})),m(URL.createObjectURL(p)))},R=f=>{n.category_ids.includes(f)||i(p=>({...p,category_ids:[...p.category_ids,f]})),c(!1)},_=f=>{i(p=>({...p,category_ids:p.category_ids.filter(j=>j!==f)}))},k=async f=>{f.preventDefault(),u(!0);try{const p=new FormData;p.append("name",n.name),p.append("price",n.price??"0"),p.append("low_stock_threshold",n.low_stock_threshold??"10"),n.category_ids.forEach(j=>p.append("category_ids[]",j)),n.image&&p.append("image_path",n.image),await o(p,t.id),r()}catch(p){console.error("Failed to update product:",p)}finally{u(!1)}},y=s.filter(f=>n.category_ids.includes(f.id));return e.jsx(we,{isOpen:a,onClose:r,title:"Edit Product",maxWidth:"2xl",children:e.jsxs("form",{onSubmit:k,children:[e.jsx("div",{className:"px-4 pt-4",children:e.jsxs("div",{className:"relative cursor-pointer",children:[e.jsx("img",{src:x||"https://via.placeholder.com/400x200",alt:"Product Preview",className:"w-full h-36 object-cover rounded-lg border border-purple-500"}),e.jsx("input",{type:"file",accept:"image/*",onChange:C,className:"absolute inset-0 opacity-0 cursor-pointer"})]})}),e.jsxs("div",{className:"px-4 pt-4",children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Item name"}),e.jsx("input",{type:"text",value:n.name,onChange:f=>w("name",f.target.value),className:"w-full border rounded-md px-3 py-2 focus:ring-2 focus:ring-purple-600",required:!0})]}),e.jsxs("div",{className:"px-4 pt-4 relative",ref:b,children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Categories"}),e.jsxs("div",{onClick:()=>c(!g),className:"border rounded-md px-3 py-2 cursor-pointer flex justify-between items-center bg-white hover:border-purple-500",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:g?"Select a category...":"Click to add category"}),e.jsx("svg",{className:`w-4 h-4 transform transition-transform ${g?"rotate-180":""}`,fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),g&&e.jsxs("div",{className:"absolute z-10 mt-1 w-[95%] bg-white border rounded-md shadow-lg max-h-48 overflow-y-auto",children:[s?.filter(f=>f.category_name!=="All"&&f.category_name!=="Uncategorized"&&!n.category_ids.includes(f.id)).map(f=>e.jsx("div",{onClick:()=>R(f.id),className:"px-3 py-2 hover:bg-purple-100 cursor-pointer text-sm text-gray-700",children:f.category_name},f.id)),s?.filter(f=>f.category_name!=="All"&&f.category_name!=="Uncategorized"&&!n.category_ids.includes(f.id)).length===0&&e.jsx("div",{className:"px-3 py-2 text-sm text-gray-400 text-center",children:"All categories selected"})]}),y.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:y.map(f=>e.jsxs("div",{className:"flex items-center gap-1 bg-purple-100 text-purple-700  rounded-full text-xs border border-purple-300",children:[e.jsx("span",{children:f.category_name}),e.jsx("button",{type:"button",onClick:()=>_(f.id),className:"text-purple-500 hover:text-purple-700",children:"âœ•"})]},f.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 px-4 pt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Price"}),e.jsx("input",{type:"number",step:"0.01",value:n.price,onChange:f=>w("price",f.target.value),className:"w-full border rounded-md px-3 py-2",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Low stock threshold"}),e.jsx("input",{type:"number",value:n.low_stock_threshold,onChange:f=>w("low_stock_threshold",f.target.value),className:"w-full border rounded-md px-3 py-2",required:!0})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 border-t border-gray-200 mt-4 p-4",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:d,className:"px-5 py-2 bg-purple-600 text-white rounded-md",children:d?"Updating...":"Confirm"})]})]})})}function ht({productsPages:t=[],categories:s=[],getStatus:a,onRestockProduct:r,onDeductProduct:o,onRemoveProduct:n,onEditProduct:i,loaderRef:d,isFetchingNextPage:u=!1}){const[x,m]=l.useState(null),[g,c]=l.useState(null),[b,w]=l.useState(!1),C=l.useRef(null),R=t.flatMap(y=>y.data||[]);l.useEffect(()=>{function y(f){C.current&&!C.current.contains(f.target)&&!f.target.closest("#edit-product-modal")&&m(null)}return x!==null&&document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[x]);const _=y=>{c(y),w(!0),m(null)},k=()=>{c(null),w(!1)};return R.length?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 overflow-y-auto divide-y divide-gray-200 text-sm text-gray-700",children:[R.map(y=>{const f=Array.isArray(y.categories)&&y.categories.length?y.categories.map(h=>h?.name).filter(Boolean):["Uncategorized"],p=f.slice(0,2),j=f.length-p.length;return e.jsxs("div",{className:"relative grid grid-cols-[80px_2fr_120px_1fr_1.5fr_1fr_80px] items-center px-8 py-2 gap-6 hover:bg-gray-50 transition",children:[e.jsx("div",{children:e.jsx("img",{src:y.image||"/placeholder.png",alt:y.name,className:"w-16 h-16 object-cover rounded"})}),e.jsx("div",{className:"font-medium truncate",children:y.name}),e.jsx("div",{className:"overflow-hidden",children:e.jsxs("span",{className:"truncate block",children:["â‚±",Number(y.price??0).toFixed(2)]})}),e.jsx("div",{className:"text-left overflow-hidden",children:e.jsx("span",{className:"truncate block",children:y.stock_quantity??0})}),e.jsxs("div",{className:"flex flex-wrap gap-1 text-xs",children:[p.map((h,v)=>e.jsx("span",{className:`px-2 py-0.5 rounded-full border ${h==="Uncategorized"?"border-gray-300 text-gray-500":"border-blue-300 bg-blue-50 text-blue-600"}`,children:h},v)),j>0&&e.jsxs("span",{className:"text-gray-400",children:["+",j," more"]})]}),e.jsx("div",{className:`capitalize font-medium ml-4 ${a(y)==="out of stock"?"text-red-500":a(y)==="low stock"?"text-yellow-500":"text-green-600"}`,children:a(y)}),e.jsxs("div",{className:"text-right relative",children:[e.jsx("button",{onClick:h=>{h.stopPropagation(),m(v=>v===y.id?null:y.id)},className:"p-2 rounded hover:bg-gray-100 transition",children:e.jsx(ot,{})}),x===y.id&&e.jsxs("div",{ref:C,onClick:h=>h.stopPropagation(),className:"absolute top-0 right-6 mr-2 w-36 bg-white border border-gray-300 rounded-lg shadow-lg z-40",children:[e.jsx("button",{onClick:()=>_(y),className:"block w-full text-left px-4 py-2 hover:bg-gray-100",children:"Edit"}),e.jsx("button",{onClick:()=>{m(null),r(y)},className:"block w-full text-left px-4 py-2 hover:bg-gray-100",children:"Restock"}),e.jsx("button",{onClick:()=>{m(null),o(y)},className:"block w-full text-left px-4 py-2 hover:bg-gray-100",children:"Deduct"}),e.jsx("button",{onClick:()=>{m(null),n(y)},className:"block w-full text-left px-4 py-2 hover:bg-gray-100 text-red-600",children:"Remove"})]})]})]},y.id)}),e.jsx("div",{ref:d,className:"h-8 flex justify-center items-center",children:u&&e.jsx("div",{className:"text-gray-500 text-sm animate-pulse",children:"Loading more products..."})})]}),g&&e.jsx(ut,{product:g,categories:s,isOpen:b,onClose:k,onSuccess:(y,f)=>i(g,y)})]}):e.jsx("div",{className:"flex justify-center items-center h-48 text-gray-500",children:"No products available."})}function ae({search:t="",category:s="All",status:a="",perPage:r=10}={}){return at({queryKey:["products",t,s,a],queryFn:async({pageParam:o=1})=>{const n=await Fe(o,r,t,s,a);return{data:n.data??[],current_page:n.current_page,last_page:n.last_page,hasMore:n.hasMore}},getNextPageParam:o=>o.hasMore?o.current_page+1:void 0,keepPreviousData:!0,staleTime:1e3*60})}async function xe(){return(await te.get("/categories")).data}async function mt(t){return console.log("ðŸ“¤ Sending to backend:",t),(await te.post("/categories",t)).data}async function gt(t){const s=[...new Set(t)];return(await te.delete("/categories/multiple",{data:{categories:s}})).data}function Ce(){const[t,s]=l.useState([]),[a,r]=l.useState(!1),[o,n]=l.useState(null);return l.useEffect(()=>{async function d(){r(!0),n(null);try{const u=await xe();s(u.data??[])}catch(u){console.error("Failed to fetch categories:",u),n(u)}finally{r(!1)}}d()},[]),{data:t,loading:a,error:o,refetch:async()=>{r(!0),n(null);try{const d=await xe();s(d.data??[])}catch(d){console.error("Failed to refetch categories:",d),n(d)}finally{r(!1)}}}}function $(t,s){l.useEffect(()=>{const a=r=>{t?.current&&!t.current.contains(r.target)&&s?.(r)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[t,s])}function ft(){const[t,s]=l.useState(""),a=ze(t,400),[r,o]=l.useState(""),[n,i]=l.useState(0),[d,u]=l.useState(!1),[x,m]=l.useState(!1),[g,c]=l.useState(!1),[b,w]=l.useState(!1),[C,R]=l.useState(!1),[_,k]=l.useState(null),[y,f]=l.useState(null),[p,j]=l.useState(null),[h,v]=l.useState(null),[S,N]=l.useState(null),P=l.useRef(null),F=l.useRef(null),M=l.useRef(null),T=l.useRef(null),K=l.useRef(null),W=l.useRef(null);$(F,()=>x&&m(!1)),$(M,()=>g&&c(!1)),$(T,()=>b&&w(!1)),$(K,()=>C&&R(!1));const{data:A=[],refetch:E}=Ce(),L=l.useMemo(()=>{const Q=A.some(Y=>Y.category_name?.toLowerCase()==="all"),z=A.some(Y=>Y.category_name?.toLowerCase()==="uncategorized");let D=A;return Q||(D=[{id:0,category_name:"All"},...D]),z||(D=[...D,{id:-1,category_name:"Uncategorized"}]),D},[A]),O=l.useMemo(()=>n===0?"":n===-1?"uncategorized":n,[n]),{data:X,fetchNextPage:Ne,hasNextPage:Pe,isFetchingNextPage:ie,refetch:Re}=ae({search:a,category:O,status:r.toLowerCase(),perPage:10}),ke=X?.pages??[];return se(W,Ne,Pe,ie),{state:{searchInput:t,statusFilter:r,selectedCategory:n,dropdownOpen:d,showCreateCategory:x,showCreateProduct:g,showRemoveCategory:b,showRemoveProducts:C,editProduct:_,restockProduct:p,deductProduct:h,removeProduct:S},setState:{setSearchInput:s,setStatusFilter:o,setSelectedCategory:i,setDropdownOpen:u,setShowCreateCategory:m,setShowCreateProduct:c,setShowRemoveCategory:w,setShowRemoveProducts:R,setEditProduct:k,setMessage:f,setRestockProduct:j,setDeductProduct:v,setRemoveProduct:N,set:(Q,z)=>{const D={searchInput:s,statusFilter:o,selectedCategory:i,dropdownOpen:u,showCreateCategory:m,showCreateProduct:c,showRemoveCategory:w,showRemoveProducts:R,editProduct:k,message:f};D[Q]?D[Q](z):console.warn(`âš ï¸ Unknown state key: "${Q}"`)}},handlers:{getStatus:Q=>{const z=Q.stock_quantity??0,D=Q.low_stock_threshold??10;return z===0?"out of stock":z<=D?"low stock":"stock"},isFetchingNextPage:ie,setEditProduct:k},filteredPages:ke,categories:L,loaderRef:W,message:y,refetch:Re,refetchCategories:E,refs:{dropdownRef:P,createCategoryRef:F,createProductRef:M,removeCategoryRef:T,removeProductsRef:K}}}function xt(){const t=U();return q({mutationFn:({id:s,formData:a})=>Ie(s,a),onSuccess:()=>{t.invalidateQueries(["products"])}})}function pt(){const t=U();return q({mutationFn:s=>De(s),onSuccess:()=>{t.invalidateQueries(["products"])}})}function yt(){const t=U();return q({mutationFn:({id:s,quantity:a})=>Te(s,{quantity:a}),onSuccess:()=>{t.invalidateQueries(["products"])}})}function bt(){const t=U();return q({mutationFn:({id:s,quantity:a,reason:r})=>Ue(s,{quantity:a,reason:r}),onSuccess:()=>{t.invalidateQueries(["products"])}})}function vt({setState:t,setMessage:s}){const a=U(),r=xt(),o=pt(),n=yt(),i=bt(),d=()=>{a.removeQueries({queryKey:["products"],exact:!1}),a.invalidateQueries({queryKey:["products"],exact:!1})};return{handleEditProduct:async(c,b)=>{try{await r.mutateAsync({id:c,formData:b}),t?.setEditProduct?.(null),s?.({type:"success",text:"Product updated successfully!"}),d()}catch(w){throw console.error("âŒ Edit product error:",w),s?.({type:"error",text:w.response?.data?.message||"Failed to update product"}),w}},handleRestockProduct:async(c,b)=>{try{await n.mutateAsync({id:c,quantity:b}),t?.setRestockProduct?.(null),s?.({type:"success",text:"Product restocked successfully!"}),d()}catch(w){throw console.error("âŒ Restock product error:",w),s?.({type:"error",text:w.response?.data?.message||"Failed to restock product"}),w}},handleDeductProduct:async(c,b,w)=>{try{await i.mutateAsync({id:c,quantity:b,reason:w}),t?.setDeductProduct?.(null),s?.({type:"success",text:"Stock deducted successfully!"}),d()}catch(C){throw console.error("âŒ Deduct product error:",C),s?.({type:"error",text:C.response?.data?.message||"Failed to deduct stock"}),C}},handleRemoveProduct:async c=>{try{await o.mutateAsync(c),t?.setRemoveProduct?.(null),s?.({type:"success",text:"Product removed successfully!"}),d()}catch(b){throw console.error("âŒ Remove product error:",b),s?.({type:"error",text:b.response?.data?.message||"Failed to remove product"}),b}},isLoading:{edit:r.isPending,restock:n.isPending,deduct:i.isPending,remove:o.isPending}}}function oe({isOpen:t,onClose:s,topPanel:a,leftPanel:r,rightPanel:o}){return l.useEffect(()=>(t&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow="auto"}),[t]),l.useEffect(()=>{const n=i=>{i.key==="Escape"&&s?.()};return t&&document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[t,s]),t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"relative bg-white w-[112vh]  h-[58vh] shadow-lg flex flex-col overflow-hidden border-2 rounded-xl border-purple-500",onClick:n=>n.stopPropagation(),children:[a&&e.jsx("div",{className:"p-4 border-b border-gray-200 min-h-[60px]",children:a}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[r&&e.jsx("div",{className:"w-1/2 flex flex-col border-r border-gray-200 overflow-y-auto",children:r}),o&&e.jsx("div",{className:"w-1/2 flex flex-col overflow-y-auto",children:o})]})]})}):null}function ne({title:t="",message:s="",items:a=[],confirmLabel:r="Confirm",cancelLabel:o="Cancel",products:n=[],onConfirm:i,onClose:d,isLoading:u=!1}){const x=l.useRef(null);l.useEffect(()=>(document.body.style.overflow="hidden",()=>document.body.style.overflow="auto"),[]),$(x,()=>{u||d?.()});const m=c=>c.stopPropagation(),g=a.length>0?a:n.map(c=>c.name||c.category_name);return e.jsxs("div",{className:"fixed inset-0 z-60 flex items-center justify-center",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60","aria-hidden":"true"}),e.jsxs("div",{ref:x,onClick:m,className:"relative h-[58vh] bg-white border-2 border-purple-500 rounded-lg shadow-xl z-10 w-full max-w-md mx-4 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 shrink-0",children:e.jsx("h2",{className:"text-lg font-semibold text-black",children:t})}),e.jsx("p",{className:"pt-4 px-4 text-red-500",children:s}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:g.length>0?g.map((c,b)=>e.jsx("div",{className:"border-2 border-purple-500 rounded-lg p-4 bg-white flex items-center",children:e.jsx("span",{className:"text-gray-800 text-sm truncate",children:c})},b)):e.jsx("p",{className:"text-gray-500 text-center text-sm py-4",children:"No items selected"})}),e.jsxs("div",{className:"flex justify-between gap-3 p-4 border-t border-gray-200 shrink-0",children:[e.jsx("button",{onClick:()=>d?.(),disabled:u,className:"px-4 py-2 border border-gray-300 rounded-lg bg-gray-200 text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:o}),e.jsx("button",{onClick:i,disabled:u,className:`px-4 py-2 rounded-lg text-white font-medium ${u?"bg-gray-400 cursor-not-allowed":"bg-purple-500 hover:bg-purple-600"}`,children:u?"Processing...":r})]})]})]})}function jt({value:t,onChange:s,isDuplicate:a}){const[r,o]=l.useState(null);l.useEffect(()=>{a?o({type:"error",text:"This category name already exists."}):r&&o(null)},[a]);const n=()=>{o(null)};return e.jsxs("div",{className:"flex w-full",children:[e.jsx("h2",{className:"text-2xl font-medium w-1/4",children:"Add new category"}),e.jsx("input",{type:"text",placeholder:"Enter category name",value:t,onChange:i=>s(i.target.value),className:` border rounded-xl w-full border-gray-200 w-fu px-3 py-2 focus:outline-none focus:ring ${a?"border-red-300 focus:border-red-500":"focus:border-blue-300"}`}),r&&e.jsx(ve,{message:r,onClose:n,duration:3e3})]})}function wt({search:t,categoryFilter:s,existingCategories:a,onSearchChange:r,onCategoryFilterChange:o}){const n=l.useMemo(()=>Array.from(new Set(a.map(d=>d?d.trim():""))).filter(d=>d.toLowerCase()!=="all"),[a]);return e.jsxs("div",{className:"mb-4 flex gap-2 p-4",children:[e.jsx("input",{type:"text",placeholder:"Search product",value:t,onChange:i=>r(i.target.value),className:"w-1/2 flex-1 border border-gray-200 rounded-lg px-3 py-2 focus:outline-none focus:ring focus:border-blue-300"}),e.jsxs("select",{value:s,onChange:i=>o(i.target.value),className:"w-1/2 border border-gray-200 rounded-lg px-2 py-2 focus:outline-none focus:ring focus:border-blue-300",children:[e.jsx("option",{value:"",children:"All Categories"}),e.jsx("option",{value:"Uncategorized",children:"Uncategorized"}),n.filter(i=>i.toLowerCase()!=="uncategorized").map((i,d)=>e.jsx("option",{value:i,children:i},d))]})]})}function Ct({products:t,isFetchingNextPage:s,loaderRef:a,onProductAdd:r}){return e.jsxs("div",{className:"flex-1 overflow-auto space-y-2 p-4",children:[t.length===0?e.jsx("div",{className:"text-gray-400 text-sm text-center py-8",children:"No products available"}):t.map(o=>e.jsxs("div",{className:"flex justify-between items-center border border-gray-200 rounded-lg px-2 py-6 hover:bg-gray-50 cursor-pointer",onClick:()=>r(o),children:[e.jsx("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:e.jsx("span",{className:"truncate",children:o.name})}),e.jsx("div",{className:"text-sm text-gray-500 flex-shrink-0 ml-2",children:Array.isArray(o.categories)&&o.categories.length>0?o.categories.map(n=>n?.category_name).filter(Boolean).join(", "):"Uncategorized"})]},o.id)),e.jsx("div",{ref:a,className:"h-10"}),s&&e.jsx("div",{className:"text-center py-2 text-gray-500",children:"Loading more..."})]})}function Nt({search:t,categoryFilter:s,availableProducts:a,existingCategories:r,isFetchingNextPage:o,loaderRef:n,onSearchChange:i,onCategoryFilterChange:d,onProductAdd:u,onCancel:x,onReset:m}){return e.jsxs(e.Fragment,{children:[e.jsx(wt,{search:t,categoryFilter:s,existingCategories:r,onSearchChange:i,onCategoryFilterChange:d}),e.jsx(Ct,{products:a,isFetchingNextPage:o,loaderRef:n,onProductAdd:u}),e.jsx("div",{className:"flex justify-end p-4 border-t border-gray-200",children:e.jsxs("div",{className:"w-full flex justify-between gap-3",children:[e.jsx("button",{onClick:x,className:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:m,className:"px-4 py-2 bg-pink-800 text-white rounded-lg hover:bg-pink-900 transition-colors",children:"Reset"})]})})]})}function Pt({products:t,onRemove:s,onCreateClick:a,isCreateDisabled:r,createButtonText:o}){return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("h3",{className:"font-semibold p-4 border-b border-gray-200",children:"Selected Items"}),e.jsx("div",{className:"flex-1 overflow-auto p-4 space-y-2",children:t.length===0?e.jsx("div",{className:"text-gray-400 text-sm text-center py-8",children:"No products selected yet"}):t.map(n=>e.jsxs("div",{className:"flex justify-between items-center border border-gray-200 rounded-lg px-2 py-4 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:n.image,alt:n.name,className:"w-8 h-8 rounded object-cover"}),e.jsx("span",{className:"truncate",children:n.name})]}),e.jsx("button",{onClick:()=>s(n.id),className:"hover:bg-red-50 rounded p-1",children:e.jsx(lt,{className:"w-4 h-4 text-red-500"})})]},n.id))}),e.jsx("div",{className:"p-4 border-t border-gray-200 flex justify-end",children:e.jsx("button",{onClick:a,disabled:r,className:` px-4 py-2 rounded text-white ${r?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:o})})]})}function Rt({categories:t=[],onClose:s,onSuccess:a,setMessage:r}){const[o,n]=l.useState(""),[i,d]=l.useState([]),[u,x]=l.useState(""),[m,g]=l.useState(""),[c,b]=l.useState(!1),[w,C]=l.useState(!1),R=l.useRef(null),_=l.useRef(null),{data:k,fetchNextPage:y,hasNextPage:f,isFetchingNextPage:p}=ae({search:u,category:m||"",perPage:10}),j=k?.pages?.flatMap(E=>E.data)??[];se(R,y,f,p);const h=l.useMemo(()=>{const E=[...t.map(O=>O.category_name?.trim()).filter(Boolean),...j.flatMap(O=>Array.isArray(O.categories)?O.categories.map(X=>X?.category_name?.trim()).filter(Boolean):[])];return["Uncategorized",...Array.from(new Set(E.map(O=>O.toLowerCase()))).map(O=>O.charAt(0).toUpperCase()+O.slice(1))]},[t,j]),v=l.useMemo(()=>(j??[]).filter(E=>!i.some(L=>L.id===E.id)),[j,i]),S=E=>d(L=>[...L,E]),N=E=>d(L=>L.filter(O=>O.id!==E)),P=()=>d([]),F=()=>{n(""),x(""),g(""),d([]),s&&s()},M=o.trim(),T=h.some(E=>E.toLowerCase()===M.toLowerCase()),K=()=>{if(!M){r({type:"warning",text:"âš ï¸ Please enter a category name"});return}if(T){r({type:"warning",text:`âš ï¸ Category "${M}" already exists`});return}b(!0)},W=async()=>{C(!0);try{const E={category_name:M,products:i.map(L=>L.id)};await mt(E),b(!1),n(""),d([]),x(""),g(""),a&&await a()}catch(E){const L=E?.response?.data,O=L?.errors?Object.values(L.errors).flat().join(" â€¢ "):L?.message||"Failed to create category";r({type:"error",text:`âŒ ${O}`}),b(!1)}finally{C(!1)}},A=T?"Category exists":w?"Creating...":"Create";return e.jsxs(e.Fragment,{children:[e.jsx(oe,{isOpen:!0,onClose:F,topPanel:e.jsx(jt,{value:o,onChange:n,isDuplicate:T}),leftPanel:e.jsx(Nt,{search:u,categoryFilter:m,availableProducts:v,existingCategories:h,isFetchingNextPage:p,loaderRef:R,onSearchChange:x,onCategoryFilterChange:g,onProductAdd:S,onReset:P,onCancel:F}),rightPanel:e.jsx(Pt,{products:i,onRemove:N,onCreateClick:K,isCreateDisabled:T||!M||w,createButtonText:A})}),c&&e.jsx(ne,{title:"Category confirmation summary",confirmLabel:"Create",categoryName:o,products:i,onClose:()=>b(!1),onConfirm:W,isLoading:w,modalRef:_})]})}function kt({onClose:t,onSuccess:s,setMessage:a,categories:r}){const[o,n]=l.useState(""),[i,d]=l.useState(1),[u,x]=l.useState(1),[m,g]=l.useState(""),[c,b]=l.useState([]),[w,C]=l.useState(null),[R,_]=l.useState(null),[k,y]=l.useState(!1);l.useEffect(()=>{const v=r.filter(S=>S.id>0).map(S=>S.id);b(S=>S.filter(N=>v.includes(N)))},[r]);const f=(v,S)=>{v<=0||b(N=>S?[...N,v]:N.filter(P=>P!==v))},p=v=>{v&&(C(v),_(URL.createObjectURL(v)))},j=()=>o.trim()?i<=0?(a?.({type:"error",text:"Price must be greater than 0."}),!1):!0:(a?.({type:"error",text:"Product name is required."}),!1);return{formState:{productName:o,price:i,quantity:u,stockThreshold:m,selectedCategories:c,productImage:R},handlers:{setProductName:n,setPrice:d,setQuantity:x,setStockThreshold:g,handleCategoryChange:f,handleImageChange:p},loading:k,handleSubmit:async v=>{if(v.preventDefault(),!!j())try{y(!0);const S=c.filter(M=>M>0),N=new FormData;N.append("name",o),N.append("price",i),N.append("stock_quantity",u),N.append("low_stock_threshold",m||0),S.forEach(M=>N.append("category_ids[]",M)),w&&N.append("image_path",w);const P=await Qe(N);(P?.data?.product||P?.product||P?.data)?.id?(a?.({type:"success",text:"Product created successfully!"}),s?.(),t?.()):a?.({type:"error",text:"Unexpected response from server."})}catch(S){const N=S?.response?.data;let P="Something went wrong.";typeof N=="string"?P=N:N?.errors?P=Object.entries(N.errors).map(([M,T])=>`${M}: ${T.join(", ")}`).join(" | "):N?.message&&(P=N.message),a?.({type:"error",text:P})}finally{y(!1)}}}}function St({onClose:t,onSuccess:s,setMessage:a,categories:r=[]}){const{formState:o,handlers:n,loading:i,handleSubmit:d}=kt({onClose:t,onSuccess:s,setMessage:a,categories:r});return e.jsx(we,{isOpen:!0,onClose:t,title:"Add new item",maxWidth:"2xl",children:e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsx(_t,{image:o.productImage,onChange:n.handleImageChange}),e.jsx(Et,{value:o.productName,onChange:n.setProductName}),e.jsx(Mt,{value:o.price,onChange:n.setPrice}),e.jsx(Ot,{categories:r,selectedCategories:o.selectedCategories,onCategoryChange:n.handleCategoryChange}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 px-6",children:[e.jsx(Lt,{value:o.quantity,onChange:n.setQuantity}),e.jsx(Ft,{value:o.stockThreshold,onChange:n.setStockThreshold})]}),e.jsxs("div",{className:"pt-4 border-t-2 border-gray-200 flex justify-between gap-4 p-4",children:[e.jsx("button",{type:"button",onClick:t,className:"px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-100",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:i,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:i?"Saving...":"Confirm"})]})]})})}function _t({image:t,onChange:s}){const a=r=>{const o=r.target.files[0];o&&s(o)};return e.jsx("div",{className:"px-6 pt-6",children:e.jsxs("label",{htmlFor:"product-image-upload",className:"block w-full h-40 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 relative overflow-hidden",children:[t?e.jsx("img",{src:t,alt:"Preview",className:"w-full h-full object-cover"}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500",children:[e.jsx(it,{}),e.jsx("span",{className:"text-sm font-medium",children:"+ Add product image"})]}),e.jsx("input",{id:"product-image-upload",type:"file",accept:"image/*",onChange:a,className:"hidden"})]})})}function Et({value:t,onChange:s}){return e.jsxs("div",{className:"px-6",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700  block",children:"Product Name"}),e.jsx("input",{type:"text",value:t,onChange:a=>s(a.target.value),placeholder:"Enter product name",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"})]})}function Mt({value:t,onChange:s}){return e.jsxs("div",{className:"px-6",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Price"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-3 text-gray-500",children:"â‚±"}),e.jsx("input",{type:"number",value:t,onChange:a=>s(Number(a.target.value)),min:"1",className:"w-full pl-7 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"})]})]})}function Ot({categories:t,selectedCategories:s,onCategoryChange:a}){const[r,o]=l.useState(""),[n,i]=l.useState(!1),d=l.useRef(null);l.useEffect(()=>{const g=c=>{d.current&&!d.current.contains(c.target)&&i(!1)};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[]);const u=(g,c)=>{a(g,c),o("")},x=t.filter(g=>g.id>0).filter(g=>g.category_name.toLowerCase().includes(r.toLowerCase())),m=s.map(g=>t.find(b=>b.id===g)?.category_name||"Unknown");return e.jsxs("div",{className:"relative",ref:d,children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block px-6",children:"Category"}),e.jsx("div",{className:"px-6",children:e.jsx("input",{type:"text",placeholder:"Search or select category...",value:r,onChange:g=>{o(g.target.value),i(!0)},onFocus:()=>i(!0),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"})}),n&&e.jsx("div",{className:"absolute left-6 right-6 mt-2 bg-white border rounded-lg shadow-lg max-h-48 overflow-y-auto z-10",children:x.length>0?x.map(g=>e.jsxs("label",{className:"flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm",children:[e.jsx("input",{type:"checkbox",checked:s.includes(g.id),onChange:c=>u(g.id,c.target.checked),className:"mr-2 h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),g.category_name]},g.id)):e.jsxs("div",{className:"text-gray-500 text-center py-2 text-sm",children:['No categories found for "',r,'"']})}),m.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3 px-6",children:m.map(g=>e.jsxs("span",{className:"px-3 py-1 bg-indigo-100 text-indigo-800 rounded-full text-sm font-medium flex items-center",children:[g,e.jsx("button",{type:"button",onClick:()=>a(t.find(c=>c.category_name===g)?.id,!1),className:"ml-2 text-indigo-800 hover:text-indigo-900",children:"Ã—"})]},g))})]})}function Lt({value:t,onChange:s}){const a=Number(t)||1,r=i=>{const d=Number(i.target.value);s(Math.max(1,d))},o=()=>{s(Math.max(1,a-1))},n=()=>{s(a+1)};return e.jsxs("div",{children:[" ",e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Quantity"}),e.jsxs("div",{className:"flex items-center w-full border border-gray-300 rounded-lg overflow-hidden",children:[e.jsx("button",{type:"button",onClick:o,className:"p-3 border-r border-gray-300 text-gray-700 hover:bg-gray-50 transition duration-150 ease-in-out flex-shrink-0",children:e.jsx(nt,{className:"w-5 h-5"})}),e.jsx("input",{type:"number",min:"1",value:a,onChange:r,className:"w-full text-center py-3 px-3 border-none focus:ring-0 focus:outline-none text-gray-800",style:{appearance:"textfield"}}),e.jsx("button",{type:"button",onClick:n,className:"p-3 border-l border-gray-300 text-gray-700 hover:bg-gray-50 transition duration-150 ease-in-out flex-shrink-0",children:e.jsx(be,{className:"w-5 h-5"})})]})]})}function Ft({value:t,onChange:s}){return e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Low Stock Threshold"}),e.jsx("input",{type:"number",value:t,onChange:a=>s(a.target.value),min:"0",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"})]})}function It(){const t=U();return q({mutationFn:Ae,onSuccess:()=>{t.invalidateQueries(["products"])}})}function Dt({onClose:t,onSuccess:s,setMessage:a}){const[r,o]=l.useState([]),[n,i]=l.useState(""),[d,u]=l.useState(!1),x=l.useRef(null),m=l.useRef(null),{data:g,fetchNextPage:c,hasNextPage:b,isFetchingNextPage:w,isLoading:C}=ae({search:n,category:"All",perPage:20}),R=l.useMemo(()=>g?.pages?.flatMap(P=>P.data)??[],[g]);se(x,c,b,w);const{mutate:_,isLoading:k}=It(),y=l.useMemo(()=>R.filter(P=>r.includes(P.id)),[R,r]),f=P=>{o(F=>F.includes(P)?F.filter(M=>M!==P):[...F,P])},p=()=>o([]),j=()=>{o([]),i(""),t&&t()},h=()=>{if(r.length===0){a&&a({type:"warning",text:"âš ï¸ Please select at least one product to remove"});return}u(!0)},v=()=>{_({products:r},{onSuccess:()=>{u(!1),o([]),i(""),s&&s(),t&&t()},onError:P=>{console.error("Remove products error:",P);const F=P?.response?.data?.message||"Failed to remove products";a&&a({type:"error",text:`âŒ ${F}`}),u(!1)}})},S=k?"Removing...":r.length>0?"Remove Selected":"Remove",N=k||r.length===0;return{formState:{selectedProducts:r,search:n,showConfirmation:d,removeButtonText:S,isRemoveDisabled:N,isLoading:C},handlers:{toggleProduct:f,handleReset:p,handleCancel:j,handleRemoveClick:h,handleConfirmRemove:v,setSearch:i,setShowConfirmation:u},productsData:{products:R,productsToDelete:y,loaderRef:x,confirmModalRef:m,isFetchingNextPage:w},isRemoving:k}}function Tt({onClose:t,onSuccess:s,setMessage:a}){const{formState:{selectedProducts:r,search:o,showConfirmation:n,removeButtonText:i,isRemoveDisabled:d,isLoading:u},handlers:{toggleProduct:x,handleReset:m,handleCancel:g,handleRemoveClick:c,handleConfirmRemove:b,setSearch:w,setShowConfirmation:C},productsData:{products:R,loaderRef:_,isFetchingNextPage:k},isRemoving:y}=Dt({onClose:t,onSuccess:s,setMessage:a}),f=e.jsx("div",{children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Remove Products"})}),p=e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4",children:e.jsx("input",{type:"text",placeholder:"Search products...",value:o,onChange:h=>w(h.target.value),className:"w-full px-3 py-2 border border-purple-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-pink-500"})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:u?e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"Loading products..."})}):R.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No products found"})}):e.jsxs("div",{className:"space-y-2",children:[R.filter(h=>!r.includes(h.id)).map(h=>e.jsx("div",{onClick:()=>x(h.id),className:"flex items-center justify-between border rounded-lg px-3 py-2 cursor-pointer transition-all hover:bg-gray-50 hover:border-gray-300",children:e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("img",{src:h.image||`https://via.placeholder.com/40?text=${h.name?.[0]||"P"}`,alt:h.name,className:"w-10 h-10 object-cover rounded shrink-0",onError:v=>{v.target.src=`https://via.placeholder.com/40?text=${h.name?.[0]||"P"}`}}),e.jsx("span",{className:"truncate font-medium text-gray-900",children:h.name})]})},h.id)),e.jsx("div",{ref:_,className:"py-4 text-center",children:k&&e.jsx("span",{className:"text-sm text-gray-500",children:"Loading more..."})})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex justify-between gap-3",children:[e.jsx("button",{onClick:g,className:"px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:m,disabled:r.length===0,className:`px-4 py-2 rounded-lg transition-colors ${r.length===0?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Reset"})]})]}),j=e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("h3",{className:"font-semibold text-gray-900",children:["Selected Products (",r.length,")"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:r.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{className:"text-sm",children:"No products selected"}),e.jsx("p",{className:"text-xs mt-1",children:"Click products to select them"})]}):e.jsx("div",{className:"space-y-2",children:R.filter(h=>r.includes(h.id)).map(h=>e.jsxs("div",{onClick:()=>x(h.id),className:"flex items-center justify-between border-2 border-purple-500 rounded-lg px-3 py-2 hover:bg-pink-50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("img",{src:h.image||`https://via.placeholder.com/32?text=${h.name?.[0]||"P"}`,alt:h.name,className:"w-8 h-8 object-cover rounded shrink-0",onError:v=>{v.target.src=`https://via.placeholder.com/32?text=${h.name?.[0]||"P"}`}}),e.jsx("span",{className:"truncate text-sm text-gray-900",children:h.name})]}),e.jsx("button",{onClick:v=>{v.stopPropagation(),x(h.id)},className:"text-red-600 hover:text-red-700 text-xl font-bold leading-none ml-2",title:"Remove from selection",children:"Ã—"})]},h.id))})}),e.jsx("div",{className:"flex justify-end p-4 border-t border-gray-200",children:e.jsx("button",{onClick:c,disabled:d,className:`px-4 py-2 rounded-lg text-white font-medium transition-colors ${d?"bg-gray-300 cursor-not-allowed":"bg-purple-500 hover:bg-purple-700"}`,children:i})})]});return e.jsxs(e.Fragment,{children:[e.jsx(oe,{isOpen:!0,onClose:g,topPanel:f,leftPanel:p,rightPanel:j}),n&&e.jsx(ne,{title:"Confirm deletion",message:"The following items will be deleted permanently",items:R.filter(h=>r.includes(h.id)).map(h=>h.name),confirmLabel:"Confirm Remove",cancelLabel:"Cancel",onConfirm:b,onClose:()=>C(!1),isLoading:y})]})}function Ut(){const t=U();return q({mutationFn:gt,onSuccess:()=>{t.invalidateQueries(["categories"])},onError:s=>{console.error("âŒ Category deletion failed:",{status:s.response?.status,message:s.response?.data?.message,details:s.response?.data?.errors})}})}function Qt({onClose:t,onSuccess:s,setMessage:a}){const[r,o]=l.useState(""),[n,i]=l.useState([]),[d,u]=l.useState(!1),x=l.useRef(null),{data:m=[],isFetching:g}=Ce(),c=l.useMemo(()=>m.filter(j=>!n.some(h=>h.id===j.id)).filter(j=>r?j.category_name.toLowerCase().includes(r.toLowerCase()):!0).filter(j=>{const h=j.category_name?.toLowerCase();return h!=="all"&&h!=="uncategorized"&&j.id!==0&&j.id!==-1}),[m,n,r]),{mutateAsync:b,isLoading:w}=Ut(),C=j=>{i(h=>h.some(v=>v.id===j.id)?h.filter(v=>v.id!==j.id):[...h,j])},R=()=>i([]),_=()=>{i([]),o(""),t&&t()},k=()=>{if(n.length===0){a&&a({type:"warning",text:"âš ï¸ Please select at least one category"});return}u(!0)},y=async()=>{try{const j=n.map(h=>h.category_name);await b(j),u(!1),i([]),o(""),s&&await s()}catch(j){console.error("Remove categories error:",j);const h=j?.response?.data,v=h?.errors?Object.values(h.errors).flat().join(" â€¢ "):h?.message||"Failed to remove categories";a&&a({type:"error",text:`âŒ ${v}`}),u(!1)}},f=w?"Removing...":n.length>0?`Remove ${n.length} ${n.length>1?"Categories":"Category"}`:"Remove",p=w||n.length===0;return{formState:{selectedCategories:n,search:r,showConfirmation:d,removeButtonText:f,isRemoveDisabled:p},handlers:{setSearch:o,handleToggleCategory:C,handleReset:R,handleCancel:_,handleRemoveClick:k,handleConfirmRemove:y,setShowConfirmation:u},categoriesData:{availableCategories:c,loaderRef:l.useRef(null),isFetchingNextPage:g},isLoading:w,confirmModalRef:x}}function At({onClose:t,onSuccess:s,setMessage:a}){const{formState:{selectedCategories:r,search:o,showConfirmation:n,removeButtonText:i,isRemoveDisabled:d},handlers:{setSearch:u,handleToggleCategory:x,handleReset:m,handleCancel:g,handleRemoveClick:c,handleConfirmRemove:b,setShowConfirmation:w},categoriesData:{availableCategories:C,isFetchingNextPage:R},isLoading:_}=Qt({onClose:t,onSuccess:s,setMessage:a}),k=e.jsx("div",{children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Remove Categories"})}),y=e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4",children:e.jsx("input",{type:"text",placeholder:"Search categories...",value:o,onChange:p=>u(p.target.value),className:"w-full px-3 py-2 border border-purple-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:C.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No categories found"})}):e.jsxs("div",{className:"space-y-2",children:[C.map(p=>{const j=r.some(h=>h.id===p.id);return e.jsxs("div",{onClick:()=>x(p),className:`flex items-center justify-between border rounded-lg p-4 cursor-pointer transition-all ${j?"bg-pink-50 border-purple-500 shadow-sm":"border-gray-200 hover:bg-gray-50 hover:border-gray-300"}`,children:[e.jsx("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:e.jsx("span",{className:"truncate text-sm font-medium text-gray-900",children:p.category_name})}),p.products_count!==void 0&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2 shrink-0",children:[p.products_count," products"]})]},p.id)}),R&&e.jsx("div",{className:"text-center py-2 text-sm text-gray-500",children:"Loading more..."})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex justify-between gap-3",children:[e.jsx("button",{onClick:g,className:"px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:m,disabled:r.length===0,className:`px-4 py-2 rounded-lg transition-colors ${r.length===0?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Reset"})]})]}),f=e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("h3",{className:"font-semibold text-gray-900",children:["Selected Categories (",r.length,")"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:r.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{className:"text-sm",children:"No categories selected"}),e.jsx("p",{className:"text-xs mt-1",children:"Select categories from the left"})]}):e.jsx("div",{className:"space-y-2",children:r.map(p=>e.jsxs("div",{onClick:()=>x(p),className:"flex items-center justify-between border-2 border-purple-500 rounded-lg p-4 hover:bg-pink-50 transition-colors cursor-pointer",children:[e.jsx("span",{className:"truncate text-sm font-medium text-gray-900",children:p.category_name}),e.jsx("button",{onClick:j=>{j.stopPropagation(),x(p)},className:"text-red-600 hover:text-red-700 text-xl font-bold leading-none ml-2",title:"Remove from selection",children:"Ã—"})]},p.id))})}),e.jsx("div",{className:"flex justify-end p-4 border-t border-gray-200",children:e.jsx("button",{onClick:c,disabled:d,className:`px-4 py-2 rounded-lg text-white font-medium transition-colors ${d?"bg-gray-300 cursor-not-allowed":"bg-purple-500 hover:bg-purple-700"}`,children:i})})]});return e.jsxs(e.Fragment,{children:[e.jsx(oe,{isOpen:!0,onClose:g,topPanel:k,leftPanel:y,rightPanel:f}),n&&e.jsx(ne,{title:"Confirm Deletion",message:"The following categories will be deleted permanently",items:r.map(p=>p.category_name),confirmLabel:"Delete",cancelLabel:"Cancel",onConfirm:b,onClose:()=>w(!1),isLoading:_})]})}function zt({product:t,onClose:s,onSuccess:a}){const[r,o]=l.useState(1),[n,i]=l.useState(!1),d=()=>o(m=>m+1),u=()=>o(m=>Math.max(1,m-1)),x=async()=>{i(!0);try{await a(r)}catch(m){console.error("Failed to restock product:",m)}finally{i(!1)}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"bg-white w-[320px] rounded-2xl border-2 border-pink-800 shadow-lg text-center",children:[e.jsx("h2",{className:"text-xl text-left font-bold p-4 border-b-2 border-gray-200",children:"Restock"}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{className:"block text-left text-sm font-semibold text-gray-800 mb-1",children:"Restock quantity"}),e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md overflow-hidden",children:[e.jsx("button",{type:"button",onClick:u,className:"w-10 h-10 text-xl text-gray-700 border-r border-gray-300 hover:bg-gray-100 transition",disabled:n,children:"â€“"}),e.jsx("span",{className:"flex-1 text-center text-gray-900 font-medium select-none",children:r}),e.jsx("button",{type:"button",onClick:d,className:"w-10 h-10 text-xl text-gray-700 border-l border-gray-300 hover:bg-gray-100 transition",disabled:n,children:"+"})]})]}),e.jsxs("div",{className:"flex justify-between p-6 border-t-2 border-gray-200",children:[e.jsx("button",{onClick:s,className:"bg-gray-300 text-gray-600 px-5 py-2 rounded-md font-medium hover:bg-gray-400 transition",disabled:n,children:"Cancel"}),e.jsx("button",{onClick:x,className:"bg-purple-600 text-white px-5 py-2 rounded-md font-medium hover:bg-purple-700 transition disabled:opacity-50",disabled:n,children:n?"Processing...":"Confirm"})]})]})})}function qt({product:t,onClose:s,onSuccess:a}){const[r,o]=l.useState(1),[n,i]=l.useState(""),[d,u]=l.useState(!1),x=()=>o(c=>c+1),m=()=>o(c=>Math.max(1,c-1)),g=async()=>{u(!0);try{await a(r,n)}catch(c){console.error("Failed to deduct product:",c)}finally{u(!1)}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"w-[320px] bg-white border-2 border-pink-800 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 border-b-2 border-gray-200 p-4",children:"Deduct"}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-1",children:"Deduct quantity"}),e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md overflow-hidden",children:[e.jsx("button",{type:"button",onClick:m,className:"w-10 h-10 text-xl text-gray-700 border-r border-gray-300 hover:bg-gray-100 transition",disabled:d,children:"â€“"}),e.jsx("span",{className:"flex-1 text-center text-gray-900 font-medium select-none",children:r}),e.jsx("button",{type:"button",onClick:x,className:"w-10 h-10 text-xl text-gray-700 border-l border-gray-300 hover:bg-gray-100 transition",disabled:d,children:"+"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-1",children:"Reason"}),e.jsx("textarea",{value:n,onChange:c=>i(c.target.value),placeholder:"example: Damaged, Lost",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none",rows:"3",disabled:d})]})]}),e.jsxs("div",{className:"flex justify-between border-t-2 border-gray-200 p-6",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 rounded-md bg-gray-200 text-gray-600 font-medium hover:bg-gray-300 transition",disabled:d,children:"Cancel"}),e.jsx("button",{onClick:g,className:"px-5 py-2 rounded-md bg-purple-500 text-white font-medium hover:bg-purple-700 transition disabled:opacity-50",disabled:d,children:d?"Processing...":"Confirm"})]})]})})}function $t({product:t,onClose:s,onSuccess:a}){const[r,o]=l.useState(!1),n=async()=>{o(!0);try{await a()}catch(i){console.error("Failed to remove product:",i)}finally{o(!1)}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"w-[320px] bg-white border-2 border-purple-500 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 p-4 border-b-2 border-gray-200",children:"Remove"}),e.jsxs("p",{className:"text-gray-800 p-6",children:["Do you really want to delete ",e.jsx("strong",{children:t?.name})," from the list?"]}),e.jsxs("div",{className:"flex justify-between border-t-2 p-6 border-gray-200",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 rounded-md bg-gray-200 text-gray-600 font-medium hover:bg-gray-300 transition",disabled:r,children:"Cancel"}),e.jsx("button",{onClick:n,className:"px-5 py-2 rounded-md bg-purple-500 text-white font-medium hover:bg-purple-700 transition disabled:opacity-50",disabled:r,children:r?"Removing...":"Confirm"})]})]})})}function Yt(){const{state:t,setState:s,handlers:a,categories:r,filteredPages:o,loaderRef:n,message:i,refetch:d,refetchCategories:u}=ft(),x=vt({setState:s,setMessage:s.setMessage}),{getStatus:m,isFetchingNextPage:g}=a;return e.jsxs("div",{className:"flex flex-col h-[88vh] bg-white rounded-xl shadow m-4 border border-gray-200",children:[e.jsx(ct,{searchInput:t.searchInput,setState:s.set,dropdownOpen:t.dropdownOpen,setDropdownOpen:s.setDropdownOpen}),e.jsx(dt,{selectedCategory:t.selectedCategory,statusFilter:t.statusFilter,setState:s.set,categories:r}),e.jsx(ht,{productsPages:o,categories:r,getStatus:m,onRestockProduct:c=>s.setRestockProduct(c),onDeductProduct:c=>s.setDeductProduct(c),onRemoveProduct:c=>s.setRemoveProduct(c),loaderRef:n,isFetchingNextPage:g,onEditProduct:(c,b)=>x.handleEditProduct(c.id,b)}),t.showCreateCategory&&e.jsx(Rt,{categories:r,setMessage:s.setMessage,onClose:()=>s.set("showCreateCategory",!1),onSuccess:()=>{s.set("showCreateCategory",!1),s.setMessage({type:"success",text:"Category created successfully!"}),d(),u()}}),t.showCreateProduct&&e.jsx(St,{categories:r,setMessage:s.setMessage,onClose:()=>s.set("showCreateProduct",!1),onSuccess:()=>{s.set("showCreateProduct",!1),s.setMessage({type:"success",text:"Product created successfully!"}),d()}}),t.showRemoveCategory&&e.jsx(At,{categories:r.filter(c=>c.category_name!=="All"&&c.category_name!=="Uncategorized"),onClose:()=>s.set("showRemoveCategory",!1),onSuccess:()=>{s.set("showRemoveCategory",!1),s.setMessage({type:"success",text:"Categories removed successfully!"}),u(),d()}}),t.showRemoveProducts&&e.jsx(Tt,{products:o.flatMap(c=>c.data||[]),onClose:()=>s.set("showRemoveProducts",!1),onSuccess:()=>{s.set("showRemoveProducts",!1),s.setMessage({type:"success",text:"Products removed successfully!"}),d()}}),t.restockProduct&&e.jsx(zt,{product:t.restockProduct,onClose:()=>s.setRestockProduct(null),onSuccess:async c=>{try{await x.handleRestockProduct(t.restockProduct.id,c),s.setRestockProduct(null),s.setMessage({type:"success",text:"Product restocked successfully!"}),d()}catch(b){console.error(b),s.setMessage({type:"error",text:"Failed to restock product."})}}}),t.deductProduct&&e.jsx(qt,{product:t.deductProduct,onClose:()=>s.setDeductProduct(null),onSuccess:async(c,b)=>{try{await x.handleDeductProduct(t.deductProduct.id,c,b),s.setDeductProduct(null),s.setMessage({type:"success",text:"Product deducted successfully!"}),d()}catch(w){console.error(w),s.setMessage({type:"error",text:"Failed to deduct product."})}}}),t.removeProduct&&e.jsx($t,{product:t.removeProduct,isOpen:!0,onClose:()=>s.setRemoveProduct(null),onSuccess:async()=>{try{await x.handleRemoveProduct(t.removeProduct.id),s.setRemoveProduct(null),s.setMessage({type:"success",text:"Product removed successfully!"}),d()}catch(c){console.error(c),s.setMessage({type:"error",text:"Failed to remove product."})}}}),e.jsx(ve,{message:i,onClose:()=>s.setMessage(null)})]})}export{Yt as default};
//# sourceMappingURL=InventoryContent-Dxu2maFG.js.map
