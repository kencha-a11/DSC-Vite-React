import{A as k,r as a,j as e}from"./index-QMmcz0e6.js";import{u as U}from"./useDebounce-aYV3m3gO.js";import{u as $}from"./useInfiniteScroll-De2QmkUJ.js";async function T(l={}){return(await k.get("/logs/time",{params:l}))?.data?.data??[]}async function E(l={}){try{const n=await k.get("/logs/sales",{params:l});return Array.isArray(n?.data?.data)?n.data.data:[]}catch(n){return console.error("Failed to fetch sales logs:",n),[]}}async function R(l={}){const n=await k.get("/logs/inventory",{params:l});return console.log("ðŸ” Raw API Response:",n.data),{logs:n?.data?.data??[],meta:n?.data?.meta??{},links:n?.data?.links??{}}}function P(){const[l,n]=a.useState([]),[o,f]=a.useState(!1),[g,N]=a.useState(""),[i,D]=a.useState(""),[c,C]=a.useState(""),[h,w]=a.useState(""),[b,v]=a.useState(1),[j,m]=a.useState(!0),S=a.useRef(),_=U(g,400),L=a.useCallback(async(t=1)=>{f(!0);try{const x=await T({user_id:i||void 0,date:c||void 0,status:h||void 0,page:t,limit:20});n(u=>t===1?x:[...u,...x]),m(x.length>0)}catch(d){console.error("âŒ Failed to fetch logs:",d),n([]),m(!1)}finally{f(!1)}},[i,c,h]);a.useEffect(()=>{n([]),v(1),m(!0)},[_,i,c,h]),a.useEffect(()=>{L(b)},[b,L]),$(S,()=>{j&&!o&&v(t=>t+1)},j,o);const r=l.filter(t=>(t.user?.name??"").toLowerCase().includes(_.toLowerCase())).filter(t=>h==="online"?t.end_time===null:h==="offline"?t.end_time!==null:!0),y=(t,d)=>{if(!t)return"--";const x=new Date(t),p=(d?new Date(d):new Date)-x,F=Math.floor(p/6e4);if(F<1)return"0m";const I=Math.floor(F/60),M=F%60;return`${I>0?`${I}h `:""}${M}m`.trim()};a.useEffect(()=>{const t=setInterval(()=>{n(d=>[...d])},6e4);return()=>clearInterval(t)},[]);const s=Array.from(new Map(l.map(t=>[t.user?.id,t.user])).values()).sort((t,d)=>(t?.name??"").localeCompare(d?.name??""));return e.jsxs("div",{className:"flex flex-col h-full bg-white rounded shadow",children:[e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center w-full",children:[e.jsx("input",{type:"text",placeholder:"Search...",value:g,onChange:t=>N(t.target.value),className:"w-1/2 min-w-[250px] p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex flex-1 gap-4",children:[e.jsxs("select",{value:i,onChange:t=>D(t.target.value),className:"flex-1 p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Filter by User"}),s.map(t=>e.jsx("option",{value:t?.id,children:t?.name},t?.id))]}),e.jsx("input",{type:"date",value:c,onChange:t=>C(t.target.value),className:"flex-1 p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("select",{value:h,onChange:t=>w(t.target.value),className:"flex-1 p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"offline",children:"Offline"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-[1.2fr_1fr_1fr_0.8fr] items-center text-gray-600 font-medium text-sm border-y border-gray-200 bg-gray-100 py-3 px-8 select-none pr-12",children:[e.jsx("div",{className:"text-left",children:"User"}),e.jsx("div",{className:"text-left",children:"Date"}),e.jsx("div",{className:"text-left",children:"Time"}),e.jsx("div",{className:"text-right",children:"Duration"})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[!o&&r.length===0&&e.jsx("p",{className:"py-6 text-center text-gray-500",children:"No logs found"}),r.map((t,d)=>{const x=new Date(t.start_time),u=t.end_time?new Date(t.end_time):null;return e.jsxs("div",{className:"grid grid-cols-[1.2fr_1fr_1fr_0.8fr] items-center px-8 py-4 border-t border-gray-200 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3 py-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-full bg-violet-500 text-white font-semibold text-lg uppercase",children:t.user?.name?t.user.name.charAt(0):"?"}),!t.end_time&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"})]}),e.jsx("span",{className:"font-medium text-gray-800",children:t.user?.name??"N/A"})]}),e.jsxs("div",{className:"text-gray-700 text-sm",children:[e.jsx("div",{children:x.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}),e.jsx("div",{className:"text-xs text-gray-500",children:x.toLocaleDateString("en-US",{weekday:"long"})})]}),e.jsxs("div",{className:"text-gray-700 text-sm",children:[e.jsxs("div",{children:["Start"," ",x.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:["End"," ",t.end_time?u.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--"]}),!t.end_time&&e.jsx("span",{className:"text-green-600 font-semibold ml-2",children:"Ongoing"})]})]}),e.jsx("div",{className:"text-gray-800 text-sm font-semibold text-right",children:y(t.start_time,t.end_time)})]},`log-${t.id??d}`)}),o&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:"Loading..."}),e.jsx("div",{ref:S,className:"h-10"})]})]})}function q(){const[l,n]=a.useState([]),[o,f]=a.useState(!1),[g,N]=a.useState(""),[i,D]=a.useState(""),[c,C]=a.useState(""),[h,w]=a.useState(1),[b,v]=a.useState(!0),j=a.useRef(),m=U(g,400),S=a.useCallback(async(r=1)=>{f(!0);try{const s=await E({user_id:i||void 0,date:c||void 0,page:r,limit:20});n(t=>r===1?s:[...t,...s]),v(s.length>0)}catch(y){console.error("Failed to fetch sales logs:",y),n([]),v(!1)}finally{f(!1)}},[i,c]);a.useEffect(()=>{n([]),w(1),v(!0)},[m,i,c]),a.useEffect(()=>{S(h)},[h,S]),$(j,()=>{b&&!o&&w(r=>r+1)},b,o);const _=l.filter(r=>(r.user?.name??"").toLowerCase().includes(m.toLowerCase())),L=Array.from(new Map(l.map(r=>[r.user?.id,r.user])).values()).sort((r,y)=>(r?.name??"").localeCompare(y?.name??""));return e.jsxs("div",{className:"flex flex-col h-full bg-white rounded shadow",children:[e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center w-full",children:[e.jsx("input",{type:"text",placeholder:"Search...",value:g,onChange:r=>N(r.target.value),className:"w-1/2 min-w-[250px] p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex flex-1 gap-4",children:[e.jsxs("select",{value:i,onChange:r=>D(r.target.value),className:"flex-1 p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Filter by User"}),L.map(r=>e.jsx("option",{value:r?.id,children:r?.name},r?.id))]}),e.jsx("input",{type:"date",value:c,onChange:r=>C(r.target.value),className:"flex-1 p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})}),e.jsxs("div",{className:"grid grid-cols-[1fr_1fr_0.5fr_0.5fr] items-center text-gray-600 font-medium text-sm border-y border-gray-200 bg-gray-100 py-3 px-8 select-none pr-14",children:[e.jsx("div",{className:"text-left",children:"Details"}),e.jsx("div",{className:"text-left",children:"Item Name"}),e.jsx("div",{className:"text-left",children:"Quantity"}),e.jsx("div",{className:"text-right",children:"Subtotal"})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[_.map((r,y)=>{const s=r.sale_items??[],t=new Date(r.created_at??Date.now()),d=s.reduce((u,p)=>u+(p.quantity??p.snapshot_quantity??0),0),x=s.reduce((u,p)=>u+parseFloat(p.subtotal??0),0);return e.jsxs("div",{className:"grid grid-cols-[1fr_1fr_0.5fr_0.5fr] border-t border-gray-200 hover:bg-gray-50 px-8 py-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-full bg-violet-500 text-white font-semibold text-lg uppercase",children:r.user?.name?r.user.name.charAt(0):"?"}),e.jsxs("div",{className:"flex flex-col text-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold",children:r.user?.name??"Unknown User"}),e.jsx("span",{className:"text-gray-500 text-sm",children:t.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}),e.jsx("span",{className:"text-gray-400 text-sm",children:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"mt-1 text-sm text-gray-600",children:[d," items"]}),e.jsxs("div",{className:"text-green-600 font-semibold text-sm",children:["Total: â‚±",x.toFixed(2)]})]})]}),e.jsx("div",{className:"flex flex-col justify-start text-gray-700 text-sm",children:s.map((u,p)=>e.jsx("div",{className:"leading-6",children:u.product?.name??u.snapshot_name??"Deleted Product"},`item-name-${p}`))}),e.jsx("div",{className:"flex flex-col justify-start text-gray-700 text-sm",children:s.map((u,p)=>e.jsx("div",{className:"leading-6",children:u.quantity??u.snapshot_quantity??0},`item-qty-${p}`))}),e.jsx("div",{className:"flex flex-col items-end text-gray-700 text-sm pr-4",children:s.map((u,p)=>e.jsxs("div",{className:"leading-6",children:["â‚±",parseFloat(u.subtotal??0).toFixed(2)]},`item-sub-${p}`))})]},`sale-${r.id??y}`)}),o&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:"Loading..."}),e.jsx("div",{ref:j,className:"h-10"})]})]})}function O(l,n){const[o,f]=a.useState(l);return a.useEffect(()=>{const g=setTimeout(()=>{f(l)},n);return()=>clearTimeout(g)},[l,n]),o}function H(l,n,o,f){a.useEffect(()=>{if(!l.current||!o||f)return;const g=new IntersectionObserver(N=>{N[0].isIntersecting&&n()},{threshold:1});return g.observe(l.current),()=>{l.current&&g.unobserve(l.current)}},[l,n,o,f])}function Q(){const[l,n]=a.useState([]),[o,f]=a.useState(!1),[g,N]=a.useState(""),[i,D]=a.useState(""),[c,C]=a.useState(""),[h,w]=a.useState(1),[b,v]=a.useState(!0),j=a.useRef(),m=O(g,400),S=(s,t)=>s||"N/A",_=a.useCallback(async(s=1)=>{f(!0);try{const t={page:s,limit:20};m&&m.trim()!==""&&(t.search=m.trim()),i&&i!==""&&(t.action=i),c&&c!==""&&(t.date=c),console.log("ðŸ” Fetching logs with params:",t),console.log("   - Search term:",m),console.log("   - Action filter:",i),console.log("   - Date filter:",c);const{logs:d,meta:x}=await R(t);console.log("ðŸ“¦ API Response:"),console.log("   - Total logs fetched:",d.length),console.log("   - Meta:",x),console.log("   - First log:",d[0]),n(u=>s===1?d:[...u,...d]),v(s<(x.last_page||1))}catch(t){console.error("âŒ Failed to fetch logs:",t),n([]),v(!1)}finally{f(!1)}},[m,i,c]);a.useEffect(()=>{console.log("ðŸ”„ Filters changed - resetting:"),console.log("   - Search:",m),console.log("   - Action:",i),console.log("   - Date:",c),n([]),w(1),v(!0)},[m,i,c]),a.useEffect(()=>{console.log("ðŸ“„ Page changed to:",h),_(h)},[h,_]),H(j,()=>{b&&!o&&w(s=>s+1)},b,o);const L=[{value:"",label:"All Actions"},{value:"created",label:"Created"},{value:"update",label:"Updated"},{value:"restock",label:"Restocked"},{value:"deducted",label:"Deducted"},{value:"deleted",label:"Deleted"}],r=s=>{switch((s??"").toLowerCase()){case"created":return"text-green-600 font-semibold";case"update":return"text-blue-600 font-semibold";case"restock":return"text-emerald-600 font-semibold";case"deducted":return"text-orange-500 font-semibold";case"deleted":return"text-red-600 font-semibold";default:return"text-gray-700"}},y=s=>({created:"Created",update:"Updated",restock:"Restocked",deducted:"Deducted",deleted:"Removed"})[s?.toLowerCase()]??s??"N/A";return e.jsxs("div",{className:"flex flex-col h-full bg-white rounded shadow",children:[e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center w-full",children:[e.jsx("input",{type:"text",placeholder:"Search by product name...",value:g,onChange:s=>N(s.target.value),className:"w-1/2 min-w-[250px] p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex flex-1 gap-4",children:[e.jsx("select",{value:i,onChange:s=>D(s.target.value),className:"flex-1 p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:L.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("input",{type:"date",value:c,onChange:s=>C(s.target.value),className:"flex-1 p-2 border rounded-lg border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})}),e.jsxs("div",{className:"grid grid-cols-[1fr_1fr_0.5fr_0.5fr] items-center text-gray-600 font-medium text-sm border-y border-gray-200 bg-gray-100 py-3 px-8 select-none",children:[e.jsx("div",{className:"text-left",children:"Action"}),e.jsx("div",{className:"text-left",children:"Quantity"}),e.jsx("div",{className:"text-left",children:"Product"}),e.jsx("div",{className:"text-right",children:"Date & Time"})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[l.length===0&&!o&&e.jsxs("p",{className:"py-6 text-center text-gray-500",children:["No inventory logs found",(m||i||c)&&e.jsx("span",{className:"block text-sm mt-2",children:"Try adjusting your filters"})]}),l.map(s=>{const t=new Date(s.created_at);return e.jsxs("div",{className:"grid grid-cols-[1fr_1fr_0.5fr_0.5fr] border-t border-gray-200 hover:bg-gray-50 px-8 py-6",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:`capitalize ${r(s.action)}`,children:y(s.action)})}),e.jsx("div",{className:"flex items-center text-gray-800 text-sm",children:s.quantity_change??"-"}),e.jsx("div",{className:"flex items-center text-gray-800 text-sm",children:S(s.product_name||"N/A")}),e.jsxs("div",{className:"flex flex-col items-end text-gray-700 text-sm",children:[e.jsx("div",{children:t.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}),e.jsx("div",{className:"text-xs text-gray-500",children:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},s.id)}),o&&e.jsx("p",{className:"py-6 text-center text-gray-500",children:"Loading..."}),e.jsx("div",{ref:j,className:"h-10"})]})]})}const A=[{key:"time",label:"Time log"},{key:"sales",label:"Sales log"},{key:"inventory",label:"Inventory log"}],G=()=>{const[l,n]=a.useState("time");return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-5rem)] bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"relative flex justify-between border border-gray-200 rounded-t-lg overflow-hidden",children:[A.map(o=>e.jsx("button",{onClick:()=>n(o.key),className:`relative flex-1 py-3 text-center font-medium transition-colors duration-300 ${l===o.key?"text-black bg-fuchsia-50":"text-gray-400 hover:text-gray-600"}`,children:o.label},o.key)),e.jsx("div",{className:"absolute bottom-0 h-1 bg-fuchsia-600 rounded-t transition-all duration-300",style:{width:`${100/A.length}%`,left:`${A.findIndex(o=>o.key===l)*(100/A.length)}%`}})]}),e.jsxs("div",{className:"flex-1 overflow-auto border border-gray-200",children:[l==="time"&&e.jsx(P,{}),l==="sales"&&e.jsx(q,{}),l==="inventory"&&e.jsx(Q,{})]})]})};export{G as default};
//# sourceMappingURL=RecordsContent-C0x6fJz8.js.map
