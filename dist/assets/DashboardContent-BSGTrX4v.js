import{j as e,r as a,A as T,u as ge}from"./index-QMmcz0e6.js";import{c as Q,U as me,B as xe,D as ue}from"./AttachMoney-Bw4RhyDO.js";import{u as F}from"./useInfiniteScroll-De2QmkUJ.js";const he=Q(e.jsx("path",{d:"m17.21 9-4.38-6.56c-.19-.28-.51-.42-.83-.42s-.64.14-.83.43L6.79 9H2c-.55 0-1 .45-1 1 0 .09.01.18.04.27l2.54 9.27c.23.84 1 1.46 1.92 1.46h13c.92 0 1.69-.62 1.93-1.46l2.54-9.27L23 10c0-.55-.45-1-1-1zM9 9l3-4.4L15 9zm3 8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"})),fe=Q([e.jsx("path",{d:"M19.5 3.5 18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2v14H3v3c0 1.66 1.34 3 3 3h12c1.66 0 3-1.34 3-3V2zM19 19c0 .55-.45 1-1 1s-1-.45-1-1v-3H8V5h11z"},"0"),e.jsx("path",{d:"M9 7h6v2H9zm7 0h2v2h-2zm-7 3h6v2H9zm7 0h2v2h-2z"},"1")]),pe=Q(e.jsx("path",{d:"m22 5.72-4.6-3.86-1.29 1.53 4.6 3.86zM7.88 3.39 6.6 1.86 2 5.71l1.29 1.53zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9m0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7"})),ae=({type:s,value:t,percentageChange:r,isIncrease:l})=>{const c=l?"text-green-600":"text-red-600",g=l?"bg-green-100":"bg-red-100",o=l?"↑":"↓",i={totalSales:{label:"Total Sales",icon:e.jsx(ue,{})},totalItems:{label:"Total Items Sold",icon:e.jsx(he,{})},totalTransactions:{label:"Total Transactions",icon:e.jsx(fe,{})},inventoryCount:{label:"Inventory Count",icon:e.jsx(xe,{})},activeUsers:{label:"Active Users",icon:e.jsx(me,{})},totalLogs:{label:"User Log",icon:e.jsx(pe,{})}}[s]||{label:s,icon:e.jsx("div",{className:"w-5 h-5 bg-gray-300"})};let n;return s==="activeUsers"?n=e.jsx("div",{className:"flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-green-100 text-green-700",children:"Active"}):s!=="totalLogs"?n=e.jsxs("div",{className:`flex items-center px-3 py-1 rounded-full text-sm font-semibold ${g} ${c}`,children:[e.jsx("span",{className:"mr-1",children:o}),e.jsx("span",{children:r})]}):n=null,e.jsxs("div",{className:"p-4 border border-gray-200 rounded-xl bg-white shadow-sm w-full",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center mb-4 border border-gray-300 rounded-lg",children:i.icon}),e.jsx("p",{className:"mb-2 text-lg text-gray-600",children:i.label}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:t}),n]})]})},ye=({title:s,data:t,selectedYear:r,onYearChange:l,className:c=""})=>{const g=t.map(n=>n.month.substring(0,3)),o=t.map(n=>n.total_sales),d=Math.max(...o),i=Array.from({length:6},(n,m)=>`₱${(d/5*m).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`);return e.jsxs("div",{className:`bg-white border border-gray-200 rounded-xl shadow-sm ${c}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:s}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:"block appearance-none w-full bg-white border border-gray-300 text-gray-700 py-2 px-4 pr-8 rounded-md leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm","aria-label":"Select year",value:r,onChange:n=>l(Number(n.target.value)),children:e.jsx("option",{value:"2025",children:"2025"})}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:e.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]})]}),e.jsxs("div",{className:"flex p-4",children:[e.jsx("div",{className:"flex flex-col justify-between pr-4 text-sm text-gray-600 font-medium whitespace-nowrap",children:i.slice().reverse().map((n,m)=>e.jsx("span",{children:n},m))}),e.jsxs("div",{className:"grow",children:[e.jsxs("svg",{className:"w-full",viewBox:"0 0 600 200",preserveAspectRatio:"none",children:[i.map((n,m)=>e.jsx("line",{x1:"0",y1:200-m*(200/(i.length-1)),x2:"600",y2:200-m*(200/(i.length-1)),stroke:"#e5e7eb",strokeWidth:"1",strokeDasharray:"2 2"},`grid-${m}`)),e.jsx("polyline",{fill:"none",stroke:"#8b5cf6",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",points:o.map((n,m)=>{const x=m/(o.length-1)*600,u=200-n/d*180;return`${x},${u}`}).join(" ")}),e.jsx("polygon",{fill:"#ede9fe",points:`0,200 ${o.map((n,m)=>{const x=m/(o.length-1)*600,u=200-n/d*180;return`${x},${u}`}).join(" ")} 600,200`})]}),e.jsx("div",{className:"flex justify-between mt-2 text-sm text-gray-600 font-medium",children:g.map((n,m)=>e.jsx("span",{children:n},m))})]})]})]})},be=({title:s="Top-selling items",items:t=[],className:r=""})=>{if(!t||t.length===0)return e.jsxs("div",{className:`bg-white border border-gray-200 rounded-xl  ${r}`,children:[e.jsx("h3",{className:"p-4 text-lg font-medium text-gray-900 border-b border-gray-200",children:s}),e.jsx("div",{className:"p-4 text-gray-500 text-sm text-center",children:"No data available"})]});const l=Math.max(...t.map(c=>c.total_sold));return e.jsxs("div",{className:`bg-white border border-gray-200 rounded-xl ${r}`,children:[e.jsx("h3",{className:"p-4 text-lg font-medium text-gray-900 border-b border-gray-200",children:s}),e.jsx("div",{className:"p-4 space-y-3",children:t.map((c,g)=>{const o=c.total_sold/l*100,d=g%2===0?"bg-blue-600":"bg-blue-300";return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm text-gray-800 mb-1",children:c.product_name}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"grow h-6 relative bg-gray-100 rounded-sm overflow-hidden",children:e.jsx("div",{className:`h-full absolute left-0 top-0 ${d}`,style:{width:`${o}%`,transition:"width 0.3s ease"}})}),e.jsxs("span",{className:"ml-3 text-sm font-semibold text-blue-600 whitespace-nowrap",children:[c.total_sold," pcs"]})]})]},g)})})]})},re=a.forwardRef(({items:s,selectedDays:t,onDaysChange:r,loading:l,sentinelRef:c,containerRef:g},o)=>{const d=[7,14,30,60,90],i=n=>{if(!n||n==="Never")return null;const m=Math.abs(new Date-new Date(n));return Math.ceil(m/(1e3*60*60*24))};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-gray-200 border-b",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Not-selling items"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("select",{value:t,onChange:n=>r(Number(n.target.value)),className:"px-3 py-1 text-sm font-semibold text-gray-700 bg-gray-100 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:d.map(n=>e.jsxs("option",{value:n,children:[n,"+"]},n))}),e.jsx("span",{className:"text-sm text-gray-700",children:"days unsold"})]})]}),e.jsxs("div",{className:"max-h-96 overflow-y-auto divide-y",ref:g,children:[s.length===0&&!l?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No items found"}):s.map((n,m)=>{const x=i(n.last_sold_date);return e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between border-gray-200",children:[e.jsx("p",{className:"text-base font-medium text-gray-800",children:n.product_name||n.name}),x!==null&&e.jsxs("span",{className:"text-gray-500",children:[x," days ago"]})]},n.id||m)}),e.jsx("div",{ref:c,className:"p-4 text-center",children:l&&e.jsx("span",{className:"text-sm text-gray-500",children:"Loading more..."})})]})]})});re.displayName="NonSellingProductList";const ve=({data:s,loading:t,sentinelRef:r,containerRef:l,loadMore:c})=>{const g=(o,d)=>o==="Out of Stock"||d===0?e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-red-100 text-red-700 rounded",children:"Out of Stock"}):e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-orange-100 text-orange-700 rounded",children:"Low Stock"});return a.useEffect(()=>{if(!r?.current||!l?.current)return;const o=new IntersectionObserver(([d])=>{d.isIntersecting&&!t&&c()},{root:l.current,rootMargin:"0px",threshold:1});return o.observe(r.current),()=>{r.current&&o.unobserve(r.current)}},[r,l,c,t]),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between p-4 border-gray-200 border-b",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Stock Alert"})}),e.jsxs("div",{className:"max-h-96 overflow-y-auto divide-y",ref:l,children:[s.length===0&&!t?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No low stock items"}):s.map((o,d)=>e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between border-gray-200",children:[e.jsx("p",{className:"text-base font-medium text-gray-800",children:o.product_name}),e.jsxs("div",{className:"flex items-center space-x-3 text-sm mt-2 sm:mt-0",children:[e.jsxs("div",{children:[e.jsx("span",{className:`font-medium ${o.stock===0?"text-red-600":o.stock<=5?"text-orange-600":"text-gray-800"}`,children:o.stock??0}),e.jsx("span",{className:"text-gray-600",children:" remaining "})]}),g(o.status,o.stock)]})]},o.id||d)),e.jsx("div",{ref:r,className:"p-4 text-center",children:t&&e.jsx("span",{className:"text-sm text-gray-500",children:"Loading more..."})})]})]})},je=async(s,t)=>(await T.get("/dashboard/manager",{params:{year:s,days:t}})).data,Ne=async(s=1,t=30)=>(await T.get("/dashboard/manager/non-selling",{params:{page:s,days:t}})).data,we=async(s=1)=>(await T.get("/dashboard/manager/low-stock",{params:{page:s}})).data,Se=async()=>(await T.get("/dashboard/cashier")).data,_e=async(s=1,t="")=>{const r=await T.get("/dashboard/cashier/inventory",{params:{page:s,search:t||void 0}});return console.log("[getCashierInventory] Response data:",r.data),r.data},Le=async(s=1,t="")=>(await T.get("/dashboard/cashier/time-logs",{params:{page:s,date:t||void 0}})).data,ke=async(s=1,t="")=>(await T.get("/dashboard/cashier/sales-logs",{params:{page:s,date:t||void 0}})).data,Ce=()=>{const[s,t]=a.useState(!0),[r,l]=a.useState(null),[c,g]=a.useState(30),[o,d]=a.useState(1),[i,n]=a.useState([]),[m,x]=a.useState(!0),[u,p]=a.useState(!1),[y,C]=a.useState(1),[N,k]=a.useState([]),[w,_]=a.useState(!0),[f,S]=a.useState(!1),I=a.useRef(null),D=a.useRef(null),L=a.useRef(null),M=a.useRef(null);a.useEffect(()=>{(async()=>{t(!0);try{const h=await je();l(h)}catch(h){console.error("Error fetching dashboard:",h)}finally{t(!1)}})()},[]),a.useEffect(()=>{(async()=>{if(!(u||!m&&o>1)){p(!0);try{const h=await Ne(o,c);n(R=>o===1?h.data:[...R,...h.data]),x(h.meta.current_page<h.meta.last_page)}catch(h){console.error("Error fetching non-selling products:",h),x(!1)}finally{p(!1)}}})()},[o,c]),a.useEffect(()=>{(async()=>{if(!(f||!w&&y>1)){S(!0);try{const h=await we(y);k(R=>y===1?h.data:[...R,...h.data]),_(h.meta.current_page<h.meta.last_page)}catch(h){console.error("Error fetching stock alerts:",h),_(!1)}finally{S(!1)}}})()},[y]);const j=a.useCallback(()=>{!u&&m&&d(h=>h+1)},[u,m]),H=a.useCallback(()=>{!f&&w&&C(h=>h+1)},[f,w]);return F(I,j,m,u,L.current),F(D,H,w,f,M.current),{loading:s,dashboard:r,nonSelling:i,stockAlerts:N,selectedDays:c,nonSellingRef:I,stockRef:D,nonSellingContainerRef:L,stockContainerRef:M,loadingNonSelling:u,loadingStock:f,handleDaysChange:h=>{g(h),d(1),n([]),x(!0)}}};function Ie(){const{loading:s,dashboard:t,nonSelling:r,stockAlerts:l,selectedDays:c,nonSellingRef:g,stockRef:o,nonSellingContainerRef:d,stockContainerRef:i,loadingNonSelling:n,loadingStock:m,handleDaysChange:x}=Ce();if(s)return e.jsx("div",{className:"p-6 text-gray-500",children:"Loading dashboard..."});if(!t)return e.jsx("div",{className:"p-6 text-red-500",children:"No dashboard data available."});const u=[{key:"totalSales",value:`₱${t.total_sales?.current?.toLocaleString()??0}`,percentageChange:t.total_sales?.change_percentage??"0",isIncrease:parseFloat(t.total_sales?.change_percentage||"0")>=0},{key:"totalItems",value:t.total_items_sold?.current??0,percentageChange:t.total_items_sold?.change_percentage??"0",isIncrease:parseFloat(t.total_items_sold?.change_percentage||"0")>=0},{key:"totalTransactions",value:t.total_transactions?.current??0,percentageChange:t.total_transactions?.change_percentage??"0",isIncrease:parseFloat(t.total_transactions?.change_percentage||"0")>=0},{key:"inventoryCount",value:t.inventory_count?.current??0,percentageChange:t.inventory_count?.change_percentage??"0",isIncrease:parseFloat(t.inventory_count?.change_percentage||"0")>=0},{key:"activeUsers",value:`${t.active_users?.active_users??0} / ${t.active_users?.total_users??0}`,percentageChange:"0",isIncrease:!0}];return e.jsxs("main",{className:"flex flex-col",children:[e.jsx("div",{className:"flex space-x-4",children:u.map(p=>e.jsx(ae,{type:p.key,value:p.value,percentageChange:p.percentageChange,isIncrease:p.isIncrease},p.key))}),e.jsxs("section",{className:"flex flex-wrap lg:flex-nowrap gap-4 mt-6",children:[e.jsxs("div",{className:"lg:w-3/5 w-full space-y-6",children:[e.jsx(ye,{title:"Yearly Sales Trend",data:t.sales_trend||[]}),e.jsx(be,{title:"Top-Selling Products",items:t.top_products||[]})]}),e.jsxs("div",{className:"lg:w-2/5 w-full flex flex-col space-y-4 h-[calc(100vh-200px)]",children:[e.jsx(re,{items:r,selectedDays:c,onDaysChange:x,loading:n,sentinelRef:g,containerRef:d}),e.jsx(ve,{data:Array.isArray(l)?l:[],loading:m,sentinelRef:o,containerRef:i})]})]})]})}const ne=a.memo(({item:s})=>{const[t,r]=a.useState(!1),l=s?.images_path?.length>0?s.images_path.find(c=>c.is_primary)?.image_path||s.images_path[0].image_path:s?.image||null;return e.jsxs("div",{className:"grid grid-cols-[80px_2fr_1fr_1.2fr_1.5fr_1fr] items-center py-3 px-4 border-b border-gray-200 hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"flex justify-center",children:l&&!t?e.jsx("img",{src:l,alt:s.product_name,loading:"lazy",className:"w-12 h-12 object-cover rounded-md",onError:()=>r(!0)}):e.jsx("div",{className:"w-12 h-12 border border-gray-300 rounded-md flex items-center justify-center text-gray-400 text-sm font-semibold bg-gray-50",children:s.product_name?.charAt(0).toUpperCase()||"?"})}),e.jsx("div",{className:"text-gray-800 font-medium truncate pr-2",title:s.product_name,children:s.product_name}),e.jsx("div",{className:"text-gray-700",children:s.stock??0}),e.jsxs("div",{className:"text-gray-700",children:["₱ ",parseFloat(s.price??0).toFixed(2)]}),e.jsx("div",{className:"text-gray-700 truncate",title:s.categories?.map(c=>c.name).join(", "),children:s.categories?.length>0?s.categories.map(c=>c.name).join(", "):"-"}),e.jsx("div",{className:`font-semibold capitalize ${s.statusColor??"text-green-600"}`,children:s.status??"In stock"})]})});ne.displayName="InventoryRow";const De=()=>e.jsx("div",{className:"animate-pulse space-y-3 p-4",children:[...Array(5)].map((s,t)=>e.jsxs("div",{className:"grid grid-cols-[80px_2fr_1fr_1.2fr_1.5fr_1fr] gap-4 items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-md"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-12"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})]},t))}),le=a.memo(({data:s,loading:t,meta:r,loadMore:l,scrollRef:c,searchTerm:g,setSearchTerm:o})=>{const d=c||a.useRef(null),i=a.useRef(null);a.useEffect(()=>{const x=i.current,u=d.current;if(!x||!u||!l)return;const p=new IntersectionObserver(([y])=>{y.isIntersecting&&!t&&r?.current_page<r?.last_page&&(console.log("[InventoryTable] Sentinel visible, loading page",r.current_page+1),l())},{root:u,rootMargin:"300px",threshold:0});return p.observe(x),()=>p.disconnect()},[t,r?.current_page,r?.last_page,l,d]);const n=!t&&s.length===0,m=t&&s.length===0;return e.jsxs("div",{className:"flex flex-col bg-white shadow-md rounded-lg overflow-hidden h-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 p-4 border-b border-gray-200 flex-none bg-white",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Inventory"}),e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx("input",{type:"text",placeholder:"Search items...",value:g,onChange:x=>o(x.target.value),className:"w-full border border-gray-300 rounded-lg py-2 px-4 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-shadow"}),g&&e.jsx("button",{onClick:()=>o(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:"✕"})]})]}),e.jsxs("div",{ref:d,className:"flex-1 min-h-0 overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 z-10 grid grid-cols-[80px_2fr_1fr_1.2fr_1.5fr_1fr] text-xs sm:text-sm font-semibold text-gray-600 bg-gray-100 border-b border-gray-300 shadow-sm",children:["Image","Item name","Stock","Unit price","Category","Status"].map((x,u)=>e.jsx("div",{className:`py-3 px-2 ${u===0?"justify-center flex":""}`,children:x},u))}),m&&e.jsx(De,{}),n&&e.jsx("div",{className:"p-4 text-gray-500",children:"No inventory items found"}),s.length>0&&e.jsxs(e.Fragment,{children:[s.map(x=>e.jsx(ne,{item:x},x.id)),e.jsx("div",{ref:i,className:"h-20"}),t&&s.length>0&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"}),e.jsx("p",{className:"mt-2 text-sm",children:"Loading more items..."})]}),!t&&r?.current_page>=r?.last_page&&s.length>0&&e.jsx("div",{className:"text-center py-4 text-gray-400 text-sm",children:"End"})]})]})]})});le.displayName="InventoryTable";const oe=a.memo(({log:s})=>{const[t,r]=a.useState(V(s?.duration));return a.useEffect(()=>{if(!s||s.end!=="Ongoing"){r(V(s?.duration));return}const l=new Date(s.start_time||s.date+" "+s.start).getTime();if(isNaN(l))return;const c=()=>{const o=Math.max(0,Date.now()-l),d=Math.floor(o/(1e3*60));r(V(d))};c();const g=setInterval(c,1e3);return()=>clearInterval(g)},[s]),e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-200 last:border-b-0 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex flex-col min-w-[50%] pr-4",children:[e.jsx("span",{className:"text-gray-800 font-medium text-base",children:s?.date}),e.jsx("span",{className:"text-gray-500 text-sm",children:s?.day})]}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsxs("span",{className:"text-gray-800 font-medium",children:["Start: ",s?.start]}),e.jsxs("span",{className:"text-gray-800 font-medium mb-1",children:["End: ",s?.end]}),e.jsxs("span",{className:"text-gray-800 font-medium",children:["Duration: ",e.jsx("span",{className:"font-bold",children:t})]})]})]})});oe.displayName="TimeLogEntry";function V(s){if(!s)return"0m";const t=Math.floor(typeof s=="number"?s:parseFloat(s)),r=Math.floor(t/60),l=t%60;return t<1?"0m":r===0?`${l}m`:l===0?`${r}h`:`${r}h ${l}m`}const Me=({data:s=[],meta:t={},loading:r=!1,scrollRef:l,sentinelRef:c})=>s.length===0&&!r?e.jsx("div",{ref:l,className:"flex-1 overflow-y-auto min-h-0 h-[53vh] flex items-center justify-center",children:e.jsx("div",{className:"text-center py-8 text-gray-400 text-lg",children:"No time logs found"})}):e.jsxs("div",{ref:l,className:"flex-1 overflow-y-auto min-h-0 h-[53vh]",children:[s.map((g,o)=>e.jsx(oe,{log:g},g.id??`time-${o}`)),e.jsx("div",{ref:c,className:"h-10"}),r&&s.length>0&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2"}),e.jsx("p",{className:"mt-2 text-sm",children:"Loading more logs..."})]}),!r&&t?.current_page>=t?.last_page&&s.length>0&&e.jsx("div",{className:"text-center py-4 text-gray-400 text-sm",children:"End"})]}),ce=a.memo(({log:s})=>{const t=s.time??"N/A";return e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-200 last:border-b-0 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex flex-col min-w-[50%] pr-4",children:[e.jsx("span",{className:"text-gray-800 font-medium text-base",children:s.date}),e.jsx("span",{className:"text-gray-500 text-sm",children:s.day}),e.jsx("span",{className:"text-gray-500 text-sm",children:t})]}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsxs("span",{className:"text-gray-800 font-medium mb-1",children:[e.jsx("span",{className:"font-bold text-fuchsia-600",children:s.items})," items"]}),e.jsxs("span",{className:"text-gray-500 text-sm",children:["Total: ",e.jsx("span",{className:"text-green-600 font-bold text-lg",children:s.total})]})]})]})});ce.displayName="SalesLogEntry";const Te=({data:s=[],meta:t={},loading:r=!1,loadMoreSalesLogs:l,scrollRef:c,sentinelRef:g,dateFilter:o=""})=>{const d=a.useMemo(()=>{let i=s;return o&&(i=i.filter(n=>n.start_time.startsWith(o))),i.sort((n,m)=>new Date(m.start_time).getTime()-new Date(n.start_time).getTime()),i},[s,o]);return a.useEffect(()=>{if(!g?.current||!l)return;const i=new IntersectionObserver(n=>{n[0].isIntersecting&&!r&&t.current_page<t.last_page&&l()},{root:null,threshold:.1});return i.observe(g.current),()=>i.disconnect()},[g,l,r,t]),d.length===0&&!r?e.jsx("div",{ref:c,className:"flex-1 overflow-y-auto min-h-0 h-[53vh] flex items-center justify-center",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-400 text-lg",children:"No sales logs found"}),o&&e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Try selecting a different date"})]})}):e.jsxs("div",{ref:c,className:"flex-1 overflow-y-auto min-h-0 h-[53vh]",children:[d.map((i,n)=>e.jsx(ce,{log:i},i.id??`sales-${n}`)),e.jsx("div",{ref:g,className:"h-10"}),r&&d.length>0&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-fuchsia-600"}),e.jsx("p",{className:"mt-2 text-sm",children:"Loading more sales..."})]}),!r&&t?.current_page>=t?.last_page&&d.length>0&&e.jsx("div",{className:"text-center py-4 text-gray-400 text-sm",children:"End"})]})},Re=({timeLogs:s=[],timeLogsMeta:t={},loadingTimeLogs:r=!1,loadMoreTimeLogs:l,timeLogsRef:c,sentinelRef:g,setTimeLogsDateFilter:o,salesLogs:d=[],salesLogsMeta:i={},loadingSalesLogs:n=!1,loadMoreSalesLogs:m,salesLogsRef:x,sentinelRefSales:u,setSalesLogsDateFilter:p})=>{const[y,C]=a.useState("timeLogs"),[N,k]=a.useState(""),w=f=>{const S=f.target.value;k(S),o(S),p(S)},_=[{id:"timeLogs",label:"Time logs"},{id:"salesLog",label:"Sales log"}];return e.jsxs("div",{className:"w-full flex flex-col bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden h-[72vh]",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-200 flex-none gap-2",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Records"}),e.jsx("input",{type:"date",value:N,onChange:w,className:"border border-gray-300 rounded-lg p-2 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-fuchsia-500"})]}),e.jsx("div",{className:"flex justify-between border-b border-gray-200 flex-none",children:_.map(f=>e.jsxs("button",{className:`w-1/2 relative p-4 text-center text-base font-semibold transition-colors ${y===f.id?"text-fuchsia-700 bg-fuchsia-50":"text-gray-500 bg-white hover:bg-gray-50"} focus:outline-none`,onClick:()=>C(f.id),children:[f.label,y===f.id&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-fuchsia-700 rounded-t-sm"})]},f.id))}),e.jsxs("div",{className:"flex-1 min-h-0 overflow-hidden",children:[y==="timeLogs"&&e.jsx(Me,{data:s,loading:r,loadMoreTimeLogs:l,meta:t,scrollRef:c,sentinelRef:g,dateFilter:N}),y==="salesLog"&&e.jsx(Te,{data:d,loading:n,loadMoreSalesLogs:m,meta:i,scrollRef:x,sentinelRef:u,dateFilter:N})]})]})},Ee=()=>{const[s,t]=a.useState(null),[r,l]=a.useState(!0),[c,g]=a.useState(null),[o,d]=a.useState([]),[i,n]=a.useState({}),[m,x]=a.useState(!1),[u,p]=a.useState(1),[y,C]=a.useState(""),N=a.useRef(null),k=a.useRef(null),[w,_]=a.useState([]),[f,S]=a.useState({}),[I,D]=a.useState(!1),[L,M]=a.useState(1),[j,H]=a.useState(""),U=a.useRef(null),h=a.useRef(null),[R,Y]=a.useState([]),[E,ie]=a.useState({}),[q,G]=a.useState(!1),[P,J]=a.useState(1),[z,de]=a.useState(""),K=a.useRef(null),X=a.useRef(null),Z=a.useCallback(async()=>{try{l(!0);const b=await Se();t(b)}catch(b){g(b)}finally{l(!1)}},[]),B=a.useCallback(async(b,$="")=>{x(!0);try{const v=await _e(b,$);d(A=>b===1?v.data:[...A,...v.data]),n(v.meta)}catch(v){g(v)}finally{x(!1)}},[]),O=a.useCallback(async(b,$="")=>{D(!0);try{const v=await Le(b,$);_(A=>b===1?v.data:[...A,...v.data]),S(v.meta)}catch(v){g(v)}finally{D(!1)}},[]),W=a.useCallback(async(b,$="")=>{G(!0);try{const v=await ke(b,$);Y(A=>b===1?v.data:[...A,...v.data]),ie(v.meta)}catch(v){g(v)}finally{G(!1)}},[]),ee=a.useCallback(()=>{i?.current_page<i?.last_page&&p(b=>b+1)},[i]),se=a.useCallback(()=>{f?.current_page<f?.last_page&&M(b=>b+1)},[f]),te=a.useCallback(()=>{E?.current_page<E?.last_page&&J(b=>b+1)},[E]);return F(k,ee,u<(i?.last_page||0),m,N),F(h,se,L<(f?.last_page||0),I,U),F(X,te,P<(E?.last_page||0),q,K),a.useEffect(()=>{Z()},[Z]),a.useEffect(()=>{p(1),d([]),B(1,y)},[y,B]),a.useEffect(()=>{u>1&&B(u,y)},[u]),a.useEffect(()=>{M(1),_([]),O(1,j)},[j,O]),a.useEffect(()=>{L>1&&O(L,j)},[L]),a.useEffect(()=>{J(1),Y([]),W(1,z)},[z,W]),a.useEffect(()=>{P>1&&W(P,z)},[P]),{dashboardData:s,loadingDashboard:r,error:c,inventory:o,inventoryMeta:i,loadingInventory:m,inventoryRef:N,inventorySentinelRef:k,loadMoreInventory:ee,inventorySearch:y,setInventorySearch:C,timeLogs:w,timeLogsMeta:f,loadingTimeLogs:I,timeLogsRef:U,timeLogsSentinelRef:h,loadMoreTimeLogs:se,timeLogsDateFilter:j,setTimeLogsDateFilter:H,salesLogs:R,salesLogsMeta:E,loadingSalesLogs:q,salesLogsRef:K,salesLogsSentinelRef:X,loadMoreSalesLogs:te,salesLogsDateFilter:z,setSalesLogsDateFilter:de}},$e=s=>{if(s==null)return"0h";const t=Math.round(Math.abs(s)*60),r=Math.floor(t/60),l=t%60;return l>0?`${r}h ${l}m`:`${r}h`};function Ae(){const{dashboardData:s,loadingDashboard:t,error:r,inventory:l,inventoryMeta:c,loadingInventory:g,loadMoreInventory:o,inventoryRef:d,inventorySentinelRef:i,inventorySearch:n,setInventorySearch:m,timeLogs:x,timeLogsMeta:u,loadingTimeLogs:p,loadMoreTimeLogs:y,timeLogsRef:C,timeLogsSentinelRef:N,setTimeLogsDateFilter:k,salesLogs:w,salesLogsMeta:_,loadingSalesLogs:f,loadMoreSalesLogs:S,salesLogsRef:I,salesLogsSentinelRef:D,setSalesLogsDateFilter:L}=Ee();if(console.log(s),t)return e.jsx("div",{children:"Loading dashboard..."});if(r)return e.jsxs("div",{children:["Error: ",r?.message]});if(!s||!s.data)return e.jsx("div",{children:"No dashboard data"});const M=[{key:"totalSales",value:`₱ ${s.data.total_sales?.current?.toLocaleString()||0}`,percentageChange:Math.abs(parseFloat(s.data.total_sales?.change_percentage)||0),isIncrease:!s.data.total_sales?.change_percentage?.includes("-")},{key:"totalItems",value:s.data.total_items_sold?.current||0,percentageChange:Math.abs(parseFloat(s.data.total_items_sold?.change_percentage)||0),isIncrease:!s.data.total_items_sold?.change_percentage?.includes("-")},{key:"totalTransactions",value:s.data.total_transactions?.current||0,percentageChange:Math.abs(parseFloat(s.data.total_transactions?.change_percentage)||0),isIncrease:!s.data.total_transactions?.change_percentage?.includes("-")},{key:"totalLogs",value:$e(s.data.total_logged_hours),percentageChange:0,isIncrease:!0}];return e.jsxs("main",{className:"flex flex-col space-y-4 h-full overflow-hidden",children:[e.jsx("section",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 flex-none",children:M.map(j=>e.jsx(ae,{type:j.key,value:j.value,percentageChange:j.percentageChange,isIncrease:j.isIncrease},j.key))}),e.jsxs("section",{className:"w-full flex flex-col lg:flex-row gap-4 flex-1 min-h-0",children:[e.jsx("div",{className:"w-full lg:w-3/5 flex flex-col min-h-0",children:e.jsx(le,{data:l,loading:g,meta:c,loadMore:o,scrollRef:d,sentinelRef:i,searchTerm:n,setSearchTerm:m})}),e.jsx("div",{className:"w-full lg:w-2/5 flex flex-col min-h-0",children:e.jsx(Re,{timeLogs:x,timeLogsMeta:u,loadingTimeLogs:p,loadMoreTimeLogs:y,scrollRef:C,sentinelRef:N,setTimeLogsDateFilter:k,salesLogs:w,salesLogsMeta:_,loadingSalesLogs:f,loadMoreSalesLogs:S,salesLogsRef:I,sentinelRefSales:D,setSalesLogsDateFilter:L})})]})]})}const Fe=a.memo(Ae);function Ue(){const{user:s}=ge();return s?e.jsx("div",{className:"p-4 h-[91.3vh] overflow-auto",children:s.role==="admin"?e.jsx(Ie,{}):e.jsx(Fe,{})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-lg text-gray-600",children:"Please log in to view dashboard"})})}export{Ue as default};
//# sourceMappingURL=DashboardContent-BSGTrX4v.js.map
